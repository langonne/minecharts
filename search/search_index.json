{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Minecharts API","text":"<p>Minecharts API automates the lifecycle of Minecraft servers inside a Kubernetes cluster. This site gives you the essentials required to run and operate the service without overwhelming detail.</p>"},{"location":"#what-the-platform-does","title":"What the Platform Does","text":"<ul> <li>Spins up Kubernetes deployments backed by persistent volumes, using the <code>itzg/minecraft-server</code> image as a base.</li> <li>Enforces authentication through JWT cookies or API keys, then applies fine-grained permissions on each request.</li> <li>Tracks users, keys, and server metadata in a database so that cluster state and API state remain aligned.</li> </ul>"},{"location":"#how-to-use-this-documentation","title":"How to Use This Documentation","text":"<ul> <li>Understand how clients interact with the service: API Overview</li> <li>Configure runtime behaviour and storage: Configuration</li> <li>Explore the persistence model and relationships: Database Architecture</li> </ul> <p>Tip: keep a terminal with <code>kubectl</code> open when experimenting. Watching deployments, pods, and PVCs appear alongside API responses is the fastest way to build intuition.</p>"},{"location":"additional-tweaks/","title":"Additional Tweaks","text":"<p>Some behaviours live outside the environment variable matrix but remain easy to tailor if your deployment model differs from the defaults.</p> <ul> <li>Default replicas: The API provisions one pod per server by default (<code>DefaultReplicas = 1</code>). Adjust the value in <code>cmd/config/config.go</code> if you want newly created worlds to spawn with more replicas.</li> <li>Container security context: Managed pods run as UID/GID <code>1000</code> and include a pre-stop hook that flushes the world save. Modify <code>cmd/kubernetes/deployement.go</code> to adapt permissions or lifecycle hooks.</li> <li>Graceful shutdown timing: The command guard (<code>mc-send-to-console save-all</code>) and wait duration before pod restart (<code>time.Second * 10</code>) are located in <code>cmd/kubernetes/utils.go</code>. Update them to match your workload\u2019s expectations.</li> </ul> <p>Whenever you introduce new knobs, wire them through the configuration package so they can be tuned via environment variables instead of code edits.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>Minecharts API reads its configuration from environment variables at startup (<code>cmd/config/config.go</code>). The following tables enumerate every supported variable and the resulting behaviour.</p>"},{"location":"configuration/#core-settings","title":"Core Settings","text":"Variable Default Purpose <code>MINECHARTS_NAMESPACE</code> <code>minecharts</code> Kubernetes namespace that hosts deployments, services, and PVCs. <code>MINECHARTS_DEPLOYMENT_PREFIX</code> <code>minecraft-server-</code> Prefix applied to server names to build deployment/service names. <code>MINECHARTS_PVC_SUFFIX</code> <code>-pvc</code> Suffix appended to PVC names. <code>MINECHARTS_STORAGE_SIZE</code> <code>10Gi</code> Capacity requested for each persistent volume claim. <code>MINECHARTS_STORAGE_CLASS</code> (empty) Storage class used when creating PVCs; the API refuses to start if it is missing.Example: <code>local-path</code> <code>MINECHARTS_MCROUTER_DOMAIN_SUFFIX</code> (empty) Domain suffix used when exposing servers through mc-router; required for the API to start.Example: <code>mc.example.com</code> <code>MINECHARTS_TRUSTED_PROXIES</code> <code>127.0.0.1</code> Comma-separated list passed to Gin to mark upstream proxies as trusted. <code>MINECHARTS_TIMEZONE</code> <code>UTC</code> Application-wide timezone for logging and time calculations. <code>MINECHARTS_MEMORY_QUOTA_ENABLED</code> <code>false</code> Enables enforcement of the global Minecraft memory quota. <code>MINECHARTS_MEMORY_QUOTA_LIMIT</code> <code>0</code> Maximum total memory (gigabytes) the cluster may allocate to Minecraft servers when the quota is enabled. <code>0</code> or negative values are treated as unlimited. <code>MINECHARTS_MEMORY_LIMIT_OVERHEAD_MI</code> <code>256</code> Extra memory (in mebibytes) added on top of each server\u2019s <code>MAX_MEMORY</code> when enforcing Kubernetes limits, to account for JVM/process overhead. <code>DATA_DIR</code> <code>./app/data</code> Local directory for SQLite data when the DB is auto-initialised."},{"location":"configuration/#database","title":"Database","text":"Variable Default Purpose <code>MINECHARTS_DB_TYPE</code> <code>sqlite</code> Database backend (<code>sqlite</code> or <code>postgres</code>). <code>MINECHARTS_DB_CONNECTION</code> <code>./app/data/minecharts.db</code> File path for SQLite or connection string for PostgreSQL."},{"location":"configuration/#authentication-security","title":"Authentication &amp; Security","text":"Variable Default Purpose <code>MINECHARTS_JWT_SECRET</code> (empty) HMAC secret used to sign JWT access tokens; the API refuses to start if it remains empty.Example: <code>change-this-super-secret</code> <code>MINECHARTS_JWT_EXPIRY_HOURS</code> <code>24</code> Token lifespan in hours. <code>MINECHARTS_API_KEY_PREFIX</code> <code>mcapi</code> Prefix applied to generated API keys."},{"location":"configuration/#oauth-authentik","title":"OAuth &amp; Authentik","text":"<p>OAuth integration is optional. Enable it by setting <code>MINECHARTS_OAUTH_ENABLED</code> to <code>true</code>.</p> Variable Default Purpose <code>MINECHARTS_OAUTH_ENABLED</code> <code>false</code> Enables the OAuth endpoints under <code>/auth/oauth/:provider</code>. <code>MINECHARTS_AUTHENTIK_ENABLED</code> <code>false</code> Toggles the Authentik provider implementation. <code>MINECHARTS_AUTHENTIK_ISSUER</code> (empty) Authentik issuer URL, e.g. <code>https://auth.example.com/application/o/</code>. <code>MINECHARTS_AUTHENTIK_CLIENT_ID</code> (empty) OAuth client ID registered with Authentik. <code>MINECHARTS_AUTHENTIK_CLIENT_SECRET</code> (empty) OAuth client secret. <code>MINECHARTS_AUTHENTIK_REDIRECT_URL</code> (empty) Redirect URL registered with Authentik, e.g. <code>https://api.example.com/auth/callback/authentik</code>."},{"location":"configuration/#logging","title":"Logging","text":"Variable Default Purpose <code>MINECHARTS_LOG_LEVEL</code> <code>info</code> Supported levels: <code>trace</code>, <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, <code>fatal</code>, <code>panic</code>. <code>MINECHARTS_LOG_FORMAT</code> <code>json</code> Output format for Logrus (<code>json</code> or <code>text</code>). <code>MINECHARTS_BCRYPT_COST</code> <code>14</code> Work factor for bcrypt hashing (valid range 4\u201331); raise for stronger security at the cost of CPU."},{"location":"configuration/#rate-limiting","title":"Rate Limiting","text":"Variable Default Purpose <code>MINECHARTS_RATE_LIMIT_LOGIN_CAPACITY</code> <code>5</code> Maximum bursts allowed for <code>POST /auth/login</code> per IP. <code>MINECHARTS_RATE_LIMIT_LOGIN_INTERVAL</code> <code>1m</code> Refill interval (Go duration format) for login tokens. <code>MINECHARTS_RATE_LIMIT_REGISTER_CAPACITY</code> <code>2</code> Maximum bursts allowed for <code>POST /auth/register</code> per IP. <code>MINECHARTS_RATE_LIMIT_REGISTER_INTERVAL</code> <code>5m</code> Refill interval for registration tokens. <code>MINECHARTS_RATE_LIMIT_USER_PATCH_CAPACITY</code> <code>5</code> Maximum bursts allowed for <code>PATCH /users/:id</code> per IP. <code>MINECHARTS_RATE_LIMIT_USER_PATCH_INTERVAL</code> <code>1m</code> Refill interval for user patch tokens. <code>MINECHARTS_RATE_LIMIT_CLEANUP_EVERY</code> <code>100</code> Cleanup frequency (in requests) for purging stale rate-limit rows. <code>MINECHARTS_RATE_LIMIT_RETENTION</code> <code>30m</code> How long to retain inactive rate-limit rows before cleanup. <code>MINECHARTS_API_KEYS_PER_USER</code> <code>5</code> Maximum number of active API keys per user. <p>Note</p> <p>The limiter state lives in the application database. PostgreSQL handles concurrent updates efficiently; SQLite serialises writes and may emit short <code>database is locked</code> retries under load. For high-traffic deployments, prefer PostgreSQL or an external rate-limiting tier.</p>"},{"location":"configuration/#feedback-issue-reporting","title":"Feedback &amp; Issue Reporting","text":"Variable Default Purpose <code>MINECHARTS_FEEDBACK_ENABLED</code> <code>false</code> Enables the authenticated <code>POST /feedback</code> endpoint that raises issues on behalf of users. <code>MINECHARTS_FEEDBACK_PROVIDER</code> (unset) Required when feedback is enabled; set to <code>github</code> or <code>gitlab</code>. <code>MINECHARTS_FEEDBACK_GITHUB_TOKEN</code> (empty) GitHub personal access token used when the provider is <code>github</code>. <code>MINECHARTS_FEEDBACK_GITHUB_REPO_OWNER</code> (empty) GitHub repository owner (user or organisation) that will receive feedback issues. <code>MINECHARTS_FEEDBACK_GITHUB_REPO_NAME</code> (empty) GitHub repository name where issues are created. <code>MINECHARTS_FEEDBACK_GITLAB_TOKEN</code> (empty) GitLab personal access token used when the provider is <code>gitlab</code>. <code>MINECHARTS_FEEDBACK_GITLAB_PROJECT</code> (empty) GitLab project path or numeric ID that receives feedback issues. <code>MINECHARTS_FEEDBACK_GITLAB_URL</code> <code>https://gitlab.com</code> Base URL for the GitLab instance (e.g. <code>https://gitlab.example.com</code>). <code>MINECHARTS_FEEDBACK_DEFAULT_LABELS</code> <code>feedback</code> Comma-separated labels automatically added to each generated issue (in addition to type-specific labels). <p>If feedback is enabled but the required credentials for the selected provider are missing, the API logs an error and any submission returns a <code>500</code> response.</p> <p>Extend the configuration package with additional environment variables when introducing new behaviours so that operators can tune the system without recompiling.</p>"},{"location":"database/","title":"Database Architecture","text":"<p>Minecharts API keeps a compact schema that mirrors the main concepts exposed by the service: users, their credentials, issued API keys, and Minecraft servers with their Kubernetes bindings. The database layer implements the same interface for SQLite (default) and PostgreSQL, so the schema applies to both backends.</p>"},{"location":"database/#core-tables","title":"Core Tables","text":""},{"location":"database/#users","title":"<code>users</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>username</code> TEXT Unique per user; used for login. <code>email</code> TEXT Optional contact address; must be unique. <code>password_hash</code> TEXT bcrypt hash created by the API. <code>permissions</code> BIGINT Bitmask containing permission flags (admin, create server, etc.). <code>active</code> BOOLEAN Controls whether the account can authenticate. <code>last_login</code> TIMESTAMP NULL Updated after successful login. <code>created_at</code> / <code>updated_at</code> TIMESTAMP Auditing metadata. <p>The permission mask is defined in <code>cmd/database/models.go</code> and shared across backends. Administrators can update it directly through the API.</p>"},{"location":"database/#api_keys","title":"<code>api_keys</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>user_id</code> BIGINT Foreign key to <code>users.id</code>. <code>key</code> TEXT Generated token (hash or plain string depending on backend). Stored in full; listings only display a masked prefix. <code>description</code> TEXT Optional label to distinguish automated clients. <code>last_used</code> TIMESTAMP NULL Updated when the key authenticates a request. <code>expires_at</code> TIMESTAMP NULL Optional expiration timestamp. <code>created_at</code> TIMESTAMP Creation time. <p>Deleting a key removes the row and immediately invalidates future requests using the token.</p>"},{"location":"database/#minecraft_servers","title":"<code>minecraft_servers</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>server_name</code> TEXT Logical name provided by the user. <code>deployment_name</code> TEXT Prefixed name used for the Kubernetes deployment. <code>pvc_name</code> TEXT Persistent volume claim name derived from the deployment. <code>owner_id</code> BIGINT Foreign key to <code>users.id</code>; identifies who can manage the server. <code>max_memory_gb</code> INTEGER Memory cap (gigabytes) propagated to the <code>MAX_MEMORY</code> container variable. Defaults to <code>1</code> when omitted. <code>status</code> TEXT Cached status (<code>running</code>, <code>stopped</code>, etc.). <code>created_at</code> / <code>updated_at</code> TIMESTAMP Lifecycle metadata. <p>The API derives <code>deployment_name</code> and <code>pvc_name</code> using configuration values (<code>MINECHARTS_DEPLOYMENT_PREFIX</code>, <code>MINECHARTS_PVC_SUFFIX</code>) to keep database records and Kubernetes resources aligned.</p> <p>When <code>MINECHARTS_MEMORY_QUOTA_ENABLED</code> is <code>true</code>, the API sums <code>max_memory_gb</code> across all rows before creating a new server and rejects the request if it would exceed <code>MINECHARTS_MEMORY_QUOTA_LIMIT</code>.</p>"},{"location":"database/#relationships-and-cascade-rules","title":"Relationships and Cascade Rules","text":"<ul> <li><code>api_keys.user_id</code> and <code>minecraft_servers.owner_id</code> reference <code>users.id</code>. The implementations enforce referential integrity at the application layer; deleting a user should be preceded by reassignment or cleanup of dependent records.</li> <li>Server operations first consult the database to verify ownership and permissions, then apply changes to Kubernetes. After a successful cluster operation, the handler updates the corresponding row (status, timestamps) to keep the database authoritative.</li> </ul>"},{"location":"database/#backend-considerations","title":"Backend Considerations","text":"<ul> <li>SQLite is the default backend for development. The database file is created automatically under <code>./app/data/minecharts.db</code> (or <code>DATA_DIR</code>). It supports foreign keys, but ensure <code>PRAGMA foreign_keys = ON</code> if you interact with it manually.</li> <li>PostgreSQL is recommended for production deployments. Provide the connection string through <code>MINECHARTS_DB_CONNECTION</code>. Schema migrations are executed at startup via the database implementation.</li> </ul> <p>Keeping the schema lean makes it straightforward to extend Minecharts with new concepts\u2014add a column, adjust the interface methods, and update both SQLite and PostgreSQL implementations accordingly.</p>"},{"location":"local-development-overlay/","title":"Local Development Overlay","text":"<p>The <code>kubernetes/overlays/test</code> overlay ships with a patch template that keeps developer-specific values outside of Git while still letting you exercise the stack end-to-end.</p> <ol> <li>Copy the sample file:    <pre><code>cp kubernetes/overlays/test/dev-env.exemple.yaml kubernetes/overlays/test/dev-env.yaml\n</code></pre></li> <li>Update <code>dev-env.yaml</code> with your own values (e.g. <code>MINECHARTS_MCROUTER_DOMAIN_SUFFIX</code>, <code>MINECHARTS_JWT_SECRET</code>, logging verbosity).</li> <li>Apply the overlay:    <pre><code>kubectl apply -k kubernetes/overlays/test\n</code></pre></li> </ol> <p>The directory contains a <code>.gitignore</code> entry that excludes <code>dev-env.yaml</code>, ensuring personal overrides never leak into commits. Only the <code>.exemple</code> file is tracked, which keeps teammates aligned on the expected structure.</p>"},{"location":"api/","title":"API Overview","text":"<p>Minecharts API is organised around a small set of REST endpoints that manage authentication, API keys, and Minecraft servers. All requests must use HTTPS in production and include either the session cookie issued at login or an API key in the <code>X-API-Key</code> header.</p> <p>Consult the related guides for deeper details on the authentication model, request lifecycle, operational considerations, and per-endpoint reference material.</p>"},{"location":"api/authentification_model/","title":"Authentication Model","text":"<ul> <li>JWT cookie (<code>auth_token</code>): returned by <code>POST /auth/login</code> and <code>POST /auth/register</code>. The cookie is HttpOnly; enable the <code>Secure</code> flag behind TLS. Include it automatically when calling other endpoints from a browser or HTTP client.</li> <li>API key: obtain one through <code>POST /apikeys</code> after logging in. Supply it via <code>X-API-Key</code>. Keys inherit the permissions of their owner and are ideal for automation where cookies are inconvenient.</li> <li>Permissions: each user carries a bitmask (admin, create server, restart, etc.). The handler chain performs the permission check after authentication; server owners automatically gain control over their own instances even when they do not hold the global bit.</li> </ul>"},{"location":"api/operational_notes/","title":"Operational Notes","text":"<ul> <li>The service automatically triggers <code>mc-send-to-console save-all</code> before restart and stop operations. Recent tests with Ceph-backed persistent volumes showed that writes can take a few minutes to settle, occasionally omitting the most recent ticks. The extra save mitigates the inconsistency but plan for a short grace period after each lifecycle change when running on Ceph.</li> <li>API key responses only reveal the raw token during creation. Store it immediately; subsequent listings return masked values.</li> <li>The <code>/servers/{serverName}/expose</code> endpoint deletes any existing service for the deployment before creating a new one, preventing stale exposure modes from lingering.</li> <li>Server creation forwards the <code>env</code> map directly to the <code>itzg/minecraft-server</code> container. Use the upstream variable reference (https://docker-minecraft-server.readthedocs.io/en/latest/variables/) when choosing flags and options.</li> </ul>"},{"location":"api/request_flow/","title":"Request Flow","text":"<ol> <li>Authenticate with a cookie or API key.</li> <li>Authorise: middleware checks the caller's permission mask (plus server ownership when applicable).</li> <li>Persist changes in the database to keep track of owners, deployments, and volumes.</li> <li>Apply changes to the Kubernetes cluster using Client-Go.</li> <li>Log outcomes with per-domain loggers for auditing and troubleshooting.</li> </ol>"},{"location":"api/endpoint/api_keys/","title":"API Key Endpoints","text":""},{"location":"api/endpoint/api_keys/#post-apikeys","title":"<code>POST /apikeys</code>","text":"<ul> <li>Purpose: Generate a new API key (revealed once).</li> <li>Auth required: JWT cookie</li> </ul> <p>Storage</p> <p>API keys are hashed before being stored in the database. Only the identifier and metadata are kept, so the raw value is visible only in the creation response. Rotate or reissue keys if you suspect a leak.</p> RequestResponse <pre><code>POST /apikeys HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\nContent-Type: application/json\n\n{\n  \"description\": \"CI pipeline\",\n  \"expires_at\": \"2025-01-01T00:00:00Z\"\n}\n</code></pre> <pre><code>{\n  \"id\": 42,\n  \"key\": \"mcapi.1df3c0d9f95f4a6f\",\n  \"description\": \"CI pipeline\",\n  \"expires_at\": \"2025-01-01T00:00:00Z\",\n  \"created_at\": \"2024-05-06T18:42:11Z\"\n}\n</code></pre>"},{"location":"api/endpoint/api_keys/#get-apikeys","title":"<code>GET /apikeys</code>","text":"<ul> <li>Purpose: List keys owned by the caller.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>GET /apikeys HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>[\n  {\n    \"id\": 42,\n    \"key\": \"mcapi.1df3c0...\",\n    \"description\": \"CI pipeline\",\n    \"last_used\": \"2024-05-12T09:17:22Z\",\n    \"expires_at\": \"2025-01-01T00:00:00Z\",\n    \"created_at\": \"2024-05-06T18:42:11Z\"\n  }\n]\n</code></pre>"},{"location":"api/endpoint/api_keys/#delete-apikeysid","title":"<code>DELETE /apikeys/{id}</code>","text":"<ul> <li>Purpose: Revoke a key immediately.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>DELETE /apikeys/42 HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"API key deleted successfully\"\n}\n</code></pre>"},{"location":"api/endpoint/authentification/","title":"Authentication Endpoints","text":""},{"location":"api/endpoint/authentification/#post-authregister","title":"<code>POST /auth/register</code>","text":"<ul> <li>Purpose: Create a user account and issue an authenticated session.</li> <li>Auth required: None</li> </ul> RequestResponse <pre><code>POST /auth/register HTTP/1.1\nContent-Type: application/json\n\n{\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"password\": \"Sup3rStrongPassword!\"\n}\n</code></pre> <pre><code>{\n  \"token\": \"&lt;jwt&gt;\",\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 0\n}\n</code></pre>"},{"location":"api/endpoint/authentification/#post-authlogin","title":"<code>POST /auth/login</code>","text":"<ul> <li>Purpose: Authenticate an existing user and receive the <code>auth_token</code> cookie.</li> <li>Auth required: None</li> </ul> <p>Rate limiting</p> <p>This endpoint (and user registration) is protected by a shared token-bucket rated at five login attempts per minute (two registrations every five minutes) per client IP. Successful requests refill progressively. When the bucket is empty, the API responds with HTTP 429 (<code>Retry-After</code> header in seconds). The limiter state is stored in the configured database so limits are consistent across application instances. On SQLite, heavy login traffic may lead to short lock retries; for high-volume production deployments prefer PostgreSQL or an external rate-limit tier.</p> RequestResponse <pre><code>POST /auth/login HTTP/1.1\nContent-Type: application/json\n\n{\n  \"username\": \"overseer\",\n  \"password\": \"Sup3rStrongPassword!\"\n}\n</code></pre> <pre><code>{\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 255\n}\n</code></pre>"},{"location":"api/endpoint/authentification/#post-authlogout","title":"<code>POST /auth/logout</code>","text":"<ul> <li>Purpose: Invalidate the active session cookie.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>POST /auth/logout HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Logout successful\",\n  \"status\": \"success\"\n}\n</code></pre>"},{"location":"api/endpoint/authentification/#get-authme","title":"<code>GET /auth/me</code>","text":"<ul> <li>Purpose: Retrieve the authenticated user profile and permissions.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>GET /auth/me HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 255,\n  \"active\": true,\n  \"last_login\": \"2024-05-10T18:12:44Z\",\n  \"created_at\": \"2024-03-01T09:15:32Z\"\n}\n</code></pre>"},{"location":"api/endpoint/feedback/","title":"Feedback Endpoint","text":""},{"location":"api/endpoint/feedback/#post-feedback","title":"<code>POST /feedback</code>","text":"<ul> <li>Purpose: Allow signed-in users to report bugs or request features.</li> <li>Auth required: JWT cookie (<code>MINECHARTS_FEEDBACK_ENABLED</code> must be <code>true</code>).</li> </ul> <p>The backend validates submissions and forwards them to either GitHub or GitLab, depending on <code>MINECHARTS_FEEDBACK_PROVIDER</code>.</p> RequestResponse <pre><code>POST /feedback HTTP/1.1\nContent-Type: application/json\n\n{\n  \"type\": \"bug\",\n  \"title\": \"Nether portal crashes the server\",\n  \"description\": \"Whenever we light the portal the server stops responding after ~30s.\",\n  \"email\": \"player@example.com\"\n}\n</code></pre> <pre><code>{\n  \"issue_url\": \"https://gitlab.example.com/my-group/minecharts/-/issues/101\",\n  \"issue_number\": 101\n}\n</code></pre>"},{"location":"api/endpoint/feedback/#validation-rules","title":"Validation rules","text":"<ul> <li><code>type</code> accepts <code>bug</code>, <code>feature</code>, or anything else (treated as <code>other</code>).</li> <li><code>title</code> and <code>description</code> are mandatory; titles are capped at 140 characters, descriptions at 5000.</li> <li>Optional <code>email</code> is trimmed and length-checked (320 characters max).</li> <li>Caller must be authenticated; the issue body includes the user ID and username.</li> </ul>"},{"location":"api/endpoint/feedback/#failure-responses","title":"Failure responses","text":"<ul> <li><code>404 Not Found</code> when the feedback endpoint is disabled.</li> <li><code>401 Unauthorized</code> if the caller is not logged in.</li> <li><code>400 Bad Request</code> for invalid payloads or missing required fields.</li> <li><code>500 Internal Server Error</code> when feedback is enabled but misconfigured (missing token, bad provider, etc.).</li> <li><code>502 Bad Gateway</code> if the target forge rejects the issue creation (temporary error).</li> </ul>"},{"location":"api/endpoint/servers/","title":"Server Endpoints","text":""},{"location":"api/endpoint/servers/#post-servers","title":"<code>POST /servers</code>","text":"<ul> <li>Purpose: Provision a server (PVC + Deployment + Service) for the caller.</li> <li>Auth required: JWT cookie or API key + <code>PermCreateServer</code></li> </ul> RequestResponse <pre><code>POST /servers HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"serverName\": \"survival\",\n  \"env\": {\n    \"EULA\": \"TRUE\",\n    \"TYPE\": \"PAPER\",\n    \"VERSION\": \"1.21.1\",\n    \"MEMORY\": \"4G\",\n    \"DIFFICULTY\": \"hard\"\n  }\n}\n</code></pre> <pre><code>{\n  \"message\": \"Minecraft server started\",\n  \"deploymentName\": \"minecraft-server-survival\",\n  \"pvcName\": \"minecraft-server-survival-pvc\",\n  \"domain\": \"survival.test.nasdak.fr\",\n  \"serviceName\": \"minecraft-server-survival-svc\",\n  \"url\": \"survival.test.nasdak.fr\"\n}\n</code></pre> <p>Environment variables</p> <p>Every key/value under <code>env</code> is passed directly to the underlying <code>itzg/minecraft-server</code> container. Refer to the image documentation for the exhaustive list of supported options: https://docker-minecraft-server.readthedocs.io/en/latest/variables/.</p> <p>MCRouter URL</p> <p>The <code>url</code> field is returned only when the backing Kubernetes service carries the <code>mc-router.itzg.me/externalServerName</code> annotation (i.e. the server is routed through mc-router).</p>"},{"location":"api/endpoint/servers/#get-servers","title":"<code>GET /servers</code>","text":"<ul> <li>Purpose: List servers owned by the caller.</li> <li>Auth required: JWT cookie or API key + <code>PermViewServer</code></li> </ul> RequestResponse <pre><code>GET /servers HTTP/1.1\nX-API-Key: mcapi.abcd1234\n</code></pre> <pre><code>[\n  {\n    \"id\": 12,\n    \"server_name\": \"survival\",\n    \"deployment_name\": \"minecraft-server-survival\",\n    \"pvc_name\": \"minecraft-server-survival-pvc\",\n    \"owner_id\": 1,\n    \"status\": \"running\",\n    \"created_at\": \"2024-05-01T10:00:00Z\",\n    \"updated_at\": \"2024-05-12T08:30:00Z\",\n    \"url\": \"survival.test.nasdak.fr\",\n    \"environment\": {\n      \"EULA\": \"TRUE\",\n      \"MEMORY\": \"4G\",\n      \"MODE\": \"survival\"\n    }\n  }\n]\n</code></pre> <p>Conditional URL</p> <p><code>url</code> is emitted only for servers exposed via mc-router.</p>"},{"location":"api/endpoint/servers/#get-serversservername","title":"<code>GET /servers/{serverName}</code>","text":"<ul> <li>Purpose: Retrieve logical metadata, environment variables, and status for a server.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermViewServer</code></li> </ul> <p>Server name format</p> <p>Server identifiers must comply with Kubernetes DNS-1123 naming: lowercase letters, digits, and dashes only, up to 63 characters. Requests with invalid names are rejected with HTTP 400.</p> RequestResponse <pre><code>GET /servers/survival HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"id\": 12,\n  \"server_name\": \"survival\",\n  \"deployment_name\": \"minecraft-server-survival\",\n  \"pvc_name\": \"minecraft-server-survival-pvc\",\n  \"owner_id\": 1,\n  \"status\": \"running\",\n  \"created_at\": \"2024-05-01T10:00:00Z\",\n  \"updated_at\": \"2024-05-12T08:30:00Z\",\n  \"url\": \"survival.test.nasdak.fr\",\n  \"environment\": {\n    \"EULA\": \"TRUE\",\n    \"TYPE\": \"PAPER\",\n    \"VERSION\": \"1.21.1\",\n    \"MEMORY\": \"4G\"\n  }\n}\n</code></pre> <p>Conditional URL</p> <p>The per-server <code>url</code> appears only when the Kubernetes service uses the mc-router annotation.</p>"},{"location":"api/endpoint/servers/#post-serversservernamerestart","title":"<code>POST /servers/{serverName}/restart</code>","text":"<ul> <li>Purpose: Save the world, update the deployment template, and trigger a rollout.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermRestartServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/restart HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server restart triggered\",\n  \"deploymentName\": \"minecraft-server-survival\",\n  \"stdout\": \"[Server thread/INFO]: Saved the game\",\n  \"stderr\": \"\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernamestop","title":"<code>POST /servers/{serverName}/stop</code>","text":"<ul> <li>Purpose: Scale the deployment to zero replicas.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermStopServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/stop HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server stopping (replicas scaled to 0)\",\n  \"deploymentName\": \"minecraft-server-survival\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernamestart","title":"<code>POST /servers/{serverName}/start</code>","text":"<ul> <li>Purpose: Scale the deployment back to one replica.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermStartServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/start HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server starting (deployment scaled to 1)\",\n  \"deploymentName\": \"minecraft-server-survival\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernamedelete","title":"<code>POST /servers/{serverName}/delete</code>","text":"<ul> <li>Purpose: Delete the deployment, service, PVC, and database record.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermDeleteServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/delete HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Deployment, PVC and network resources deleted\",\n  \"deploymentName\": \"minecraft-server-survival\",\n  \"pvcName\": \"minecraft-server-survival-pvc\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernameexec","title":"<code>POST /servers/{serverName}/exec</code>","text":"<ul> <li>Purpose: Run a console command via <code>mc-send-to-console</code> inside the pod.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermExecCommand</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/exec HTTP/1.1\nX-API-Key: mcapi.abcd1234\nContent-Type: application/json\n\n{\n  \"command\": \"say Hello from automation!\"\n}\n</code></pre> <pre><code>{\n  \"stdout\": \"[Server thread/INFO]: [Server] Hello from automation!\\n\",\n  \"stderr\": \"\",\n  \"command\": \"say Hello from automation!\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernameexpose","title":"<code>POST /servers/{serverName}/expose</code>","text":"<ul> <li>Purpose: Recreate the service (ClusterIP, NodePort, LoadBalancer, or mc-router mode).</li> <li>Auth required: JWT cookie or API key + owner or <code>PermCreateServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/expose HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"exposureType\": \"NodePort\",\n  \"port\": 25565\n}\n</code></pre> <pre><code>{\n  \"message\": \"Service created\",\n  \"serviceName\": \"minecraft-server-survival-svc\",\n  \"exposureType\": \"NodePort\",\n  \"serviceType\": \"NodePort\",\n  \"nodePort\": 32751\n}\n</code></pre>"},{"location":"api/endpoint/servers/#get-ws-websocket-log-stream","title":"<code>GET /ws</code> (WebSocket log stream)","text":"<ul> <li>Purpose: Stream <code>logs/latest.log</code> from a running Minecraft pod in real time.</li> <li> <p>Auth required: JWT cookie (<code>auth_token</code>) or API key (<code>X-API-Key</code> header on the upgrade request) + owner or <code>PermViewServer</code> permission for the target server.</p> </li> <li> <p>Open a WebSocket connection to <code>GET /ws</code>, including the authentication headers/cookies you normally use with the API.</p> </li> <li> <p>Immediately after the handshake, send a single JSON message selecting the server:</p> <pre><code>{ \"server_id\": 42 }\n</code></pre> <p>The <code>server_id</code> is the numeric identifier returned by <code>GET /servers</code>.</p> </li> <li> <p>When the subscription is accepted, the API responds with a <code>status</code> message and begins streaming the log file.</p> </li> </ul>"},{"location":"api/endpoint/servers/#message-types","title":"Message types","text":"<ul> <li><code>{\"type\":\"status\",\"message\":\"connected\"}</code> \u2014 WebSocket upgrade acknowledged.</li> <li><code>{\"type\":\"status\",\"message\":\"streaming\"}</code> \u2014 log streaming has started.</li> <li><code>{\"type\":\"log\",\"data\":\"[Server thread/INFO]: ...\\n\"}</code> \u2014 raw lines from <code>logs/latest.log</code> (standard output).</li> <li><code>{\"type\":\"error\",\"message\":\"...\"}</code> \u2014 authentication/authorization errors, missing pods, or stderr output from the tail command.</li> </ul> <p>The server executes <code>tail -n +1 -F</code>, so the entire file is replayed before following new lines. Each client connection has its own tail process; closing the WebSocket stops the stream immediately.</p>"},{"location":"api/endpoint/users/","title":"User Administration Endpoints","text":""},{"location":"api/endpoint/users/#get-users","title":"<code>GET /users</code>","text":"<ul> <li>Purpose: List every user in the system.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>GET /users HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>[\n  {\n    \"id\": 1,\n    \"username\": \"admin\",\n    \"email\": \"admin@example.com\",\n    \"permissions\": 255,\n    \"active\": true,\n    \"last_login\": \"2024-05-10T18:12:44Z\",\n    \"created_at\": \"2024-03-01T09:15:32Z\",\n    \"updated_at\": \"2024-05-10T18:12:44Z\"\n  }\n]\n</code></pre>"},{"location":"api/endpoint/users/#get-usersid","title":"<code>GET /users/{id}</code>","text":"<ul> <li>Purpose: Retrieve a specific user. Non-admins can fetch their own record only.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code> (or matching user ID)</li> </ul> RequestResponse <pre><code>GET /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>{\n  \"id\": 2,\n  \"username\": \"builder\",\n  \"email\": \"builder@example.com\",\n  \"permissions\": 10,\n  \"active\": true,\n  \"last_login\": \"2024-05-08T14:02:11Z\",\n  \"created_at\": \"2024-04-20T12:00:00Z\",\n  \"updated_at\": \"2024-05-08T14:02:11Z\"\n}\n</code></pre>"},{"location":"api/endpoint/users/#patch-usersid","title":"<code>PATCH /users/{id}</code>","text":"<ul> <li>Purpose: Partially update username, email, password, permissions, or active flag.</li> <li>Auth required: JWT cookie. Users may patch their own record; administrators may patch any user. Only admins may modify <code>permissions</code> or <code>active</code>.</li> </ul> <p>Rate limiting</p> <p>Updates are throttled to five attempts per minute per client IP to contain brute-force password checks and account enumeration. As with the authentication endpoints, the limiter state is persisted in the database. Under heavy concurrency SQLite can emit brief <code>database is locked</code> retries; PostgreSQL is recommended for large installations.</p> Self-updateAdmin updateResponse <pre><code>PATCH /users/2 HTTP/1.1\nCookie: auth_token=&lt;user_jwt&gt;\nContent-Type: application/json\n\n{\n  \"email\": \"player2@example.com\",\n  \"password\": {\n    \"current\": \"OldPassword123!\",\n    \"new\": \"NewPassword456@\",\n    \"confirm\": \"NewPassword456@\"\n  }\n}\n</code></pre> <pre><code>PATCH /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"username\": \"builder\",\n  \"permissions\": 10,\n  \"active\": true\n}\n</code></pre> <pre><code>{\n  \"id\": 2,\n  \"username\": \"builder\",\n  \"email\": \"player2@example.com\",\n  \"permissions\": 10,\n  \"active\": true,\n  \"last_login\": \"2024-05-08T14:02:11Z\",\n  \"updated_at\": \"2024-05-12T10:05:33Z\"\n}\n</code></pre> <p>Password policy</p> <p>When changing a password, the payload must include <code>current</code>, <code>new</code>, and <code>confirm</code>. The new password must be at least 12 characters long and contain upper-case, lower-case, digit, and symbol characters.</p>"},{"location":"api/endpoint/users/#post-usersidpermissionsgrant","title":"<code>POST /users/{id}/permissions/grant</code>","text":"<ul> <li>Purpose: Add one or more permission bits to a user.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>POST /users/2/permissions/grant HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"permissions\": [\n    { \"permission\": 2, \"name\": \"PermDeleteServer\" },\n    { \"permission\": 64, \"name\": \"PermExecCommand\" }\n  ]\n}\n</code></pre> <pre><code>{\n  \"user_id\": 2,\n  \"username\": \"builder\",\n  \"old_permissions\": 8,\n  \"new_permissions\": 74\n}\n</code></pre>"},{"location":"api/endpoint/users/#post-usersidpermissionsrevoke","title":"<code>POST /users/{id}/permissions/revoke</code>","text":"<ul> <li>Purpose: Remove permission bits from a user.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>POST /users/2/permissions/revoke HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"permissions\": [\n    { \"permission\": 2 },\n    { \"permission\": 64 }\n  ]\n}\n</code></pre> <pre><code>{\n  \"user_id\": 2,\n  \"username\": \"builder\",\n  \"old_permissions\": 74,\n  \"new_permissions\": 8\n}\n</code></pre>"},{"location":"api/endpoint/users/#delete-usersid","title":"<code>DELETE /users/{id}</code>","text":"<ul> <li>Purpose: Permanently delete a user account.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>DELETE /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"User deleted\"\n}\n</code></pre>"}]}