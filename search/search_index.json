{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Minecharts API","text":"<p>Minecharts API automates the lifecycle of Minecraft servers inside a Kubernetes cluster. This site gives you the essentials required to run and operate the service without overwhelming detail.</p>"},{"location":"#what-the-platform-does","title":"What the Platform Does","text":"<ul> <li>Spins up Kubernetes deployments backed by persistent volumes, using the <code>itzg/minecraft-server</code> image as a base.</li> <li>Enforces authentication through JWT cookies or API keys, then applies fine-grained permissions on each request.</li> <li>Tracks users, keys, and server metadata in a database so that cluster state and API state remain aligned.</li> </ul>"},{"location":"#how-to-use-this-documentation","title":"How to Use This Documentation","text":"<ul> <li>Understand how clients interact with the service: API Overview</li> <li>Configure runtime behaviour and storage: Configuration</li> <li>Explore the persistence model and relationships: Database Architecture</li> </ul> <p>Tip: keep a terminal with <code>kubectl</code> open when experimenting. Watching deployments, pods, and PVCs appear alongside API responses is the fastest way to build intuition.</p>"},{"location":"api/","title":"API Overview","text":"<p>Minecharts API is organised around a small set of REST endpoints that manage authentication, API keys, and Minecraft servers. All requests must use HTTPS in production and include either the session cookie issued at login or an API key in the <code>X-API-Key</code> header.</p>"},{"location":"api/#authentication-model","title":"Authentication Model","text":"<ul> <li>JWT cookie (<code>auth_token</code>): returned by <code>POST /auth/login</code> and <code>POST /auth/register</code>. The cookie is HttpOnly; enable the <code>Secure</code> flag behind TLS. Include it automatically when calling other endpoints from a browser or HTTP client.</li> <li>API key: obtain one through <code>POST /apikeys</code> after logging in. Supply it via <code>X-API-Key</code>. Keys inherit the permissions of their owner and are ideal for automation where cookies are inconvenient.</li> <li>Permissions: each user carries a bitmask (admin, create server, restart, etc.). The handler chain performs the permission check after authentication; server owners automatically gain control over their own instances even when they do not hold the global bit.</li> </ul>"},{"location":"api/#endpoint-reference","title":"Endpoint Reference","text":"<p>Each section below summarises the endpoint\u2019s purpose, the authentication requirement, and provides a sample request you can adapt.</p>"},{"location":"api/#authentication","title":"Authentication","text":""},{"location":"api/#post-authregister","title":"<code>POST /auth/register</code>","text":"<ul> <li>Purpose: Create a user account and issue an authenticated session.</li> <li>Auth required: None</li> </ul> RequestResponse <pre><code>POST /auth/register HTTP/1.1\nContent-Type: application/json\n\n{\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"password\": \"Sup3rStrongPassword!\"\n}\n</code></pre> <pre><code>{\n  \"token\": \"&lt;jwt&gt;\",\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 0\n}\n</code></pre>"},{"location":"api/#post-authlogin","title":"<code>POST /auth/login</code>","text":"<ul> <li>Purpose: Authenticate an existing user and receive the <code>auth_token</code> cookie.</li> <li>Auth required: None</li> </ul> RequestResponse <pre><code>POST /auth/login HTTP/1.1\nContent-Type: application/json\n\n{\n  \"username\": \"overseer\",\n  \"password\": \"Sup3rStrongPassword!\"\n}\n</code></pre> <pre><code>{\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 255\n}\n</code></pre>"},{"location":"api/#post-authlogout","title":"<code>POST /auth/logout</code>","text":"<ul> <li>Purpose: Invalidate the active session cookie.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>POST /auth/logout HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Logout successful\",\n  \"status\": \"success\"\n}\n</code></pre>"},{"location":"api/#get-authme","title":"<code>GET /auth/me</code>","text":"<ul> <li>Purpose: Retrieve the authenticated user profile and permissions.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>GET /auth/me HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 255,\n  \"active\": true,\n  \"last_login\": \"2024-05-10T18:12:44Z\",\n  \"created_at\": \"2024-03-01T09:15:32Z\"\n}\n</code></pre>"},{"location":"api/#api-keys","title":"API Keys","text":""},{"location":"api/#post-apikeys","title":"<code>POST /apikeys</code>","text":"<ul> <li>Purpose: Generate a new API key (revealed once).</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>POST /apikeys HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\nContent-Type: application/json\n\n{\n  \"description\": \"CI pipeline\",\n  \"expires_at\": \"2025-01-01T00:00:00Z\"\n}\n</code></pre> <pre><code>{\n  \"id\": 42,\n  \"key\": \"mcapi.1df3c0d9f95f4a6f\",\n  \"description\": \"CI pipeline\",\n  \"expires_at\": \"2025-01-01T00:00:00Z\",\n  \"created_at\": \"2024-05-06T18:42:11Z\"\n}\n</code></pre>"},{"location":"api/#get-apikeys","title":"<code>GET /apikeys</code>","text":"<ul> <li>Purpose: List keys owned by the caller.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>GET /apikeys HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>[\n  {\n    \"id\": 42,\n    \"key\": \"mcapi.1df3c0...\",\n    \"description\": \"CI pipeline\",\n    \"last_used\": \"2024-05-12T09:17:22Z\",\n    \"expires_at\": \"2025-01-01T00:00:00Z\",\n    \"created_at\": \"2024-05-06T18:42:11Z\"\n  }\n]\n</code></pre>"},{"location":"api/#delete-apikeysid","title":"<code>DELETE /apikeys/{id}</code>","text":"<ul> <li>Purpose: Revoke a key immediately.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>DELETE /apikeys/42 HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"API key deleted successfully\"\n}\n</code></pre>"},{"location":"api/#servers","title":"Servers","text":""},{"location":"api/#post-servers","title":"<code>POST /servers</code>","text":"<ul> <li>Purpose: Provision a server (PVC + Deployment + Service) for the caller.</li> <li>Auth required: JWT cookie or API key + <code>PermCreateServer</code></li> </ul> RequestResponse <pre><code>POST /servers HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"serverName\": \"survival\",\n  \"env\": {\n    \"EULA\": \"TRUE\",\n    \"TYPE\": \"PAPER\",\n    \"VERSION\": \"1.21.1\",\n    \"MEMORY\": \"4G\",\n    \"DIFFICULTY\": \"hard\"\n  }\n}\n</code></pre> <pre><code>{\n  \"message\": \"Minecraft server started\",\n  \"deploymentName\": \"minecraft-server-survival\",\n  \"pvcName\": \"minecraft-server-survival-pvc\",\n  \"domain\": \"survival.test.nasdak.fr\",\n  \"serviceName\": \"minecraft-server-survival-svc\",\n  \"url\": \"survival.test.nasdak.fr\"\n}\n</code></pre> <p>Environment variables</p> <p>Every key/value under <code>env</code> is passed directly to the underlying <code>itzg/minecraft-server</code> container. Refer to the image documentation for the exhaustive list of supported options: https://docker-minecraft-server.readthedocs.io/en/latest/variables/.</p> <p>MCRouter URL</p> <p>The <code>url</code> field is returned only when the backing Kubernetes service carries the <code>mc-router.itzg.me/externalServerName</code> annotation (i.e. the server is routed through mc-router).</p>"},{"location":"api/#get-servers","title":"<code>GET /servers</code>","text":"<ul> <li>Purpose: List servers owned by the caller.</li> <li>Auth required: JWT cookie or API key + <code>PermViewServer</code></li> </ul> RequestResponse <pre><code>GET /servers HTTP/1.1\nX-API-Key: mcapi.abcd1234\n</code></pre> <pre><code>[\n  {\n    \"id\": 12,\n    \"server_name\": \"survival\",\n    \"deployment_name\": \"minecraft-server-survival\",\n    \"pvc_name\": \"minecraft-server-survival-pvc\",\n    \"owner_id\": 1,\n    \"status\": \"running\",\n    \"created_at\": \"2024-05-01T10:00:00Z\",\n    \"updated_at\": \"2024-05-12T08:30:00Z\",\n    \"url\": \"survival.test.nasdak.fr\",\n    \"environment\": {\n      \"EULA\": \"TRUE\",\n      \"MEMORY\": \"4G\",\n      \"MODE\": \"survival\"\n    }\n  }\n]\n</code></pre> <p>Conditional URL</p> <p><code>url</code> is emitted only for servers exposed via mc-router.</p>"},{"location":"api/#get-serversservername","title":"<code>GET /servers/{serverName}</code>","text":"<ul> <li>Purpose: Retrieve logical metadata, environment variables, and status for a server.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermViewServer</code></li> </ul> RequestResponse <pre><code>GET /servers/survival HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"id\": 12,\n  \"server_name\": \"survival\",\n  \"deployment_name\": \"minecraft-server-survival\",\n  \"pvc_name\": \"minecraft-server-survival-pvc\",\n  \"owner_id\": 1,\n  \"status\": \"running\",\n  \"created_at\": \"2024-05-01T10:00:00Z\",\n  \"updated_at\": \"2024-05-12T08:30:00Z\",\n  \"url\": \"survival.test.nasdak.fr\",\n  \"environment\": {\n    \"EULA\": \"TRUE\",\n    \"TYPE\": \"PAPER\",\n    \"VERSION\": \"1.21.1\",\n    \"MEMORY\": \"4G\"\n  }\n}\n</code></pre> <p>Conditional URL</p> <p>The per-server <code>url</code> appears only when the Kubernetes service uses the mc-router annotation.</p>"},{"location":"api/#post-serversservernamerestart","title":"<code>POST /servers/{serverName}/restart</code>","text":"<ul> <li>Purpose: Save the world, update the deployment template, and trigger a rollout.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermRestartServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/restart HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server restart triggered\",\n  \"deploymentName\": \"minecraft-server-survival\",\n  \"stdout\": \"[Server thread/INFO]: Saved the game\",\n  \"stderr\": \"\"\n}\n</code></pre>"},{"location":"api/#post-serversservernamestop","title":"<code>POST /servers/{serverName}/stop</code>","text":"<ul> <li>Purpose: Scale the deployment to zero replicas.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermStopServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/stop HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server stopping (replicas scaled to 0)\",\n  \"deploymentName\": \"minecraft-server-survival\"\n}\n</code></pre>"},{"location":"api/#post-serversservernamestart","title":"<code>POST /servers/{serverName}/start</code>","text":"<ul> <li>Purpose: Scale the deployment back to one replica.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermStartServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/start HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server starting (deployment scaled to 1)\",\n  \"deploymentName\": \"minecraft-server-survival\"\n}\n</code></pre>"},{"location":"api/#post-serversservernamedelete","title":"<code>POST /servers/{serverName}/delete</code>","text":"<ul> <li>Purpose: Delete the deployment, service, PVC, and database record.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermDeleteServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/delete HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Deployment, PVC and network resources deleted\",\n  \"deploymentName\": \"minecraft-server-survival\",\n  \"pvcName\": \"minecraft-server-survival-pvc\"\n}\n</code></pre>"},{"location":"api/#post-serversservernameexec","title":"<code>POST /servers/{serverName}/exec</code>","text":"<ul> <li>Purpose: Run a console command via <code>mc-send-to-console</code> inside the pod.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermExecCommand</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/exec HTTP/1.1\nX-API-Key: mcapi.abcd1234\nContent-Type: application/json\n\n{\n  \"command\": \"say Hello from automation!\"\n}\n</code></pre> <pre><code>{\n  \"stdout\": \"[Server thread/INFO]: [Server] Hello from automation!\\n\",\n  \"stderr\": \"\",\n  \"command\": \"say Hello from automation!\"\n}\n</code></pre>"},{"location":"api/#post-serversservernameexpose","title":"<code>POST /servers/{serverName}/expose</code>","text":"<ul> <li>Purpose: Recreate the service (ClusterIP, NodePort, LoadBalancer, or mc-router mode).</li> <li>Auth required: JWT cookie or API key + owner or <code>PermCreateServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/expose HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"exposureType\": \"NodePort\",\n  \"port\": 25565\n}\n</code></pre> <pre><code>{\n  \"message\": \"Service created\",\n  \"serviceName\": \"minecraft-server-survival-svc\",\n  \"exposureType\": \"NodePort\",\n  \"serviceType\": \"NodePort\",\n  \"nodePort\": 32751\n}\n</code></pre>"},{"location":"api/#users-administration","title":"Users (administration)","text":""},{"location":"api/#get-users","title":"<code>GET /users</code>","text":"<ul> <li>Purpose: List every user in the system.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>GET /users HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>[\n  {\n    \"id\": 1,\n    \"username\": \"admin\",\n    \"email\": \"admin@example.com\",\n    \"permissions\": 255,\n    \"active\": true,\n    \"last_login\": \"2024-05-10T18:12:44Z\",\n    \"created_at\": \"2024-03-01T09:15:32Z\",\n    \"updated_at\": \"2024-05-10T18:12:44Z\"\n  }\n]\n</code></pre>"},{"location":"api/#get-usersid","title":"<code>GET /users/{id}</code>","text":"<ul> <li>Purpose: Retrieve a specific user. Non-admins can fetch their own record only.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code> (or matching user ID)</li> </ul> RequestResponse <pre><code>GET /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>{\n  \"id\": 2,\n  \"username\": \"builder\",\n  \"email\": \"builder@example.com\",\n  \"permissions\": 10,\n  \"active\": true,\n  \"last_login\": \"2024-05-08T14:02:11Z\",\n  \"created_at\": \"2024-04-20T12:00:00Z\",\n  \"updated_at\": \"2024-05-08T14:02:11Z\"\n}\n</code></pre>"},{"location":"api/#put-usersid","title":"<code>PUT /users/{id}</code>","text":"<ul> <li>Purpose: Update username, email, password, permissions, or active flag.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>PUT /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"email\": \"player2@example.com\",\n  \"permissions\": 10,\n  \"active\": true\n}\n</code></pre> <pre><code>{\n  \"id\": 2,\n  \"username\": \"builder\",\n  \"email\": \"player2@example.com\",\n  \"permissions\": 10,\n  \"active\": true,\n  \"last_login\": \"2024-05-08T14:02:11Z\",\n  \"updated_at\": \"2024-05-12T10:05:33Z\"\n}\n</code></pre>"},{"location":"api/#post-usersidpermissionsgrant","title":"<code>POST /users/{id}/permissions/grant</code>","text":"<ul> <li>Purpose: Add one or more permission bits to a user.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>POST /users/2/permissions/grant HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"permissions\": [\n    { \"permission\": 2, \"name\": \"PermDeleteServer\" },\n    { \"permission\": 64, \"name\": \"PermExecCommand\" }\n  ]\n}\n</code></pre> <pre><code>{\n  \"user_id\": 2,\n  \"username\": \"builder\",\n  \"old_permissions\": 8,\n  \"new_permissions\": 74\n}\n</code></pre>"},{"location":"api/#post-usersidpermissionsrevoke","title":"<code>POST /users/{id}/permissions/revoke</code>","text":"<ul> <li>Purpose: Remove permission bits from a user.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>POST /users/2/permissions/revoke HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"permissions\": [\n    { \"permission\": 2 },\n    { \"permission\": 64 }\n  ]\n}\n</code></pre> <pre><code>{\n  \"user_id\": 2,\n  \"username\": \"builder\",\n  \"old_permissions\": 74,\n  \"new_permissions\": 8\n}\n</code></pre>"},{"location":"api/#delete-usersid","title":"<code>DELETE /users/{id}</code>","text":"<ul> <li>Purpose: Permanently delete a user account.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>DELETE /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"User deleted\"\n}\n</code></pre>"},{"location":"api/#request-flow","title":"Request Flow","text":"<ol> <li>Authenticate with a cookie or API key.</li> <li>Authorise: middleware checks the caller's permission mask (plus server ownership when applicable).</li> <li>Persist changes in the database to keep track of owners, deployments, and volumes.</li> <li>Apply changes to the Kubernetes cluster using Client-Go.</li> <li>Log outcomes with per-domain loggers for auditing and troubleshooting.</li> </ol>"},{"location":"api/#operational-notes","title":"Operational Notes","text":"<ul> <li>The service automatically triggers <code>mc-send-to-console save-all</code> before restart and stop operations. Recent tests with Ceph-backed persistent volumes showed that writes can take a few minutes to settle, occasionally omitting the most recent ticks. The extra save mitigates the inconsistency but plan for a short grace period after each lifecycle change when running on Ceph.</li> <li>API key responses only reveal the raw token during creation. Store it immediately; subsequent listings return masked values.</li> <li>The <code>/servers/{serverName}/expose</code> endpoint deletes any existing service for the deployment before creating a new one, preventing stale exposure modes from lingering.</li> <li>Server creation forwards the <code>env</code> map directly to the <code>itzg/minecraft-server</code> container. Use the upstream variable reference (https://docker-minecraft-server.readthedocs.io/en/latest/variables/) when choosing flags and options.</li> </ul> <p>With these fundamentals you can wire Minecharts API into control panels, scripts, or CI pipelines without diving into implementation details.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>Minecharts API reads its configuration from environment variables at startup (<code>cmd/config/config.go</code>). The following tables enumerate every supported variable and the resulting behaviour.</p>"},{"location":"configuration/#core-settings","title":"Core Settings","text":"Variable Default Purpose <code>MINECHARTS_NAMESPACE</code> <code>minecharts</code> Kubernetes namespace that hosts deployments, services, and PVCs. <code>MINECHARTS_DEPLOYMENT_PREFIX</code> <code>minecraft-server-</code> Prefix applied to server names to build deployment/service names. <code>MINECHARTS_PVC_SUFFIX</code> <code>-pvc</code> Suffix appended to PVC names. <code>MINECHARTS_STORAGE_SIZE</code> <code>10Gi</code> Capacity requested for each persistent volume claim. <code>MINECHARTS_STORAGE_CLASS</code> <code>rook-ceph-block</code> Storage class used when creating PVCs; change to match your cluster. <code>MINECHARTS_MCROUTER_DOMAIN_SUFFIX</code> <code>test.nasdak.fr</code> Domain suffix used when exposing servers through mc-router. <code>MINECHARTS_TRUSTED_PROXIES</code> <code>127.0.0.1</code> Comma-separated list passed to Gin to mark upstream proxies as trusted. <code>MINECHARTS_TIMEZONE</code> <code>UTC</code> Application-wide timezone for logging and time calculations. <code>DATA_DIR</code> <code>./app/data</code> Local directory for SQLite data when the DB is auto-initialised."},{"location":"configuration/#database","title":"Database","text":"Variable Default Purpose <code>MINECHARTS_DB_TYPE</code> <code>sqlite</code> Database backend (<code>sqlite</code> or <code>postgres</code>). <code>MINECHARTS_DB_CONNECTION</code> <code>./app/data/minecharts.db</code> File path for SQLite or connection string for PostgreSQL."},{"location":"configuration/#authentication-security","title":"Authentication &amp; Security","text":"Variable Default Purpose <code>MINECHARTS_JWT_SECRET</code> <code>your-secret-key-change-me-in-production</code> HMAC secret used to sign JWT access tokens; must be overridden in production. <code>MINECHARTS_JWT_EXPIRY_HOURS</code> <code>24</code> Token lifespan in hours. <code>MINECHARTS_API_KEY_PREFIX</code> <code>mcapi</code> Prefix applied to generated API keys."},{"location":"configuration/#oauth-authentik","title":"OAuth &amp; Authentik","text":"<p>OAuth integration is optional. Enable it by setting <code>MINECHARTS_OAUTH_ENABLED</code> to <code>true</code>.</p> Variable Default Purpose <code>MINECHARTS_OAUTH_ENABLED</code> <code>false</code> Enables the OAuth endpoints under <code>/auth/oauth/:provider</code>. <code>MINECHARTS_AUTHENTIK_ENABLED</code> <code>false</code> Toggles the Authentik provider implementation. <code>MINECHARTS_AUTHENTIK_ISSUER</code> (empty) Authentik issuer URL, e.g. <code>https://auth.example.com/application/o/</code>. <code>MINECHARTS_AUTHENTIK_CLIENT_ID</code> (empty) OAuth client ID registered with Authentik. <code>MINECHARTS_AUTHENTIK_CLIENT_SECRET</code> (empty) OAuth client secret. <code>MINECHARTS_AUTHENTIK_REDIRECT_URL</code> (empty) Redirect URL registered with Authentik, e.g. <code>https://api.example.com/auth/callback/authentik</code>."},{"location":"configuration/#logging","title":"Logging","text":"Variable Default Purpose <code>MINECHARTS_LOG_LEVEL</code> <code>info</code> Supported levels: <code>trace</code>, <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, <code>fatal</code>, <code>panic</code>. <code>MINECHARTS_LOG_FORMAT</code> <code>json</code> Output format for Logrus (<code>json</code> or <code>text</code>)."},{"location":"configuration/#additional-tweaks","title":"Additional Tweaks","text":"<p>Some behaviours are currently hard-coded but easy to adapt if required: - <code>DefaultReplicas</code> is set to <code>1</code>, meaning each server starts with a single pod. Update <code>cmd/config/config.go</code> if you need a different default. - Pods run as UID/GID <code>1000</code> and add a lifecycle pre-stop hook that saves the world. Edit <code>cmd/kubernetes/deployement.go</code> to customise these values. - The command guard <code>mc-send-to-console save-all</code> and the wait duration before restart (<code>10s</code>) are located in <code>cmd/kubernetes/utils.go</code>.</p> <p>Extend the configuration package with additional environment variables when introducing new behaviours so that operators can tune the system without recompiling.</p>"},{"location":"database/","title":"Database Architecture","text":"<p>Minecharts API keeps a compact schema that mirrors the main concepts exposed by the service: users, their credentials, issued API keys, and Minecraft servers with their Kubernetes bindings. The database layer implements the same interface for SQLite (default) and PostgreSQL, so the schema applies to both backends.</p>"},{"location":"database/#core-tables","title":"Core Tables","text":""},{"location":"database/#users","title":"<code>users</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>username</code> TEXT Unique per user; used for login. <code>email</code> TEXT Optional contact address; must be unique. <code>password_hash</code> TEXT bcrypt hash created by the API. <code>permissions</code> BIGINT Bitmask containing permission flags (admin, create server, etc.). <code>active</code> BOOLEAN Controls whether the account can authenticate. <code>last_login</code> TIMESTAMP NULL Updated after successful login. <code>created_at</code> / <code>updated_at</code> TIMESTAMP Auditing metadata. <p>The permission mask is defined in <code>cmd/database/models.go</code> and shared across backends. Administrators can update it directly through the API.</p>"},{"location":"database/#api_keys","title":"<code>api_keys</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>user_id</code> BIGINT Foreign key to <code>users.id</code>. <code>key</code> TEXT Generated token (hash or plain string depending on backend). Stored in full; listings only display a masked prefix. <code>description</code> TEXT Optional label to distinguish automated clients. <code>last_used</code> TIMESTAMP NULL Updated when the key authenticates a request. <code>expires_at</code> TIMESTAMP NULL Optional expiration timestamp. <code>created_at</code> TIMESTAMP Creation time. <p>Deleting a key removes the row and immediately invalidates future requests using the token.</p>"},{"location":"database/#minecraft_servers","title":"<code>minecraft_servers</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>server_name</code> TEXT Logical name provided by the user. <code>deployment_name</code> TEXT Prefixed name used for the Kubernetes deployment. <code>pvc_name</code> TEXT Persistent volume claim name derived from the deployment. <code>owner_id</code> BIGINT Foreign key to <code>users.id</code>; identifies who can manage the server. <code>status</code> TEXT Cached status (<code>running</code>, <code>stopped</code>, etc.). <code>created_at</code> / <code>updated_at</code> TIMESTAMP Lifecycle metadata. <p>The API derives <code>deployment_name</code> and <code>pvc_name</code> using configuration values (<code>MINECHARTS_DEPLOYMENT_PREFIX</code>, <code>MINECHARTS_PVC_SUFFIX</code>) to keep database records and Kubernetes resources aligned.</p>"},{"location":"database/#relationships-and-cascade-rules","title":"Relationships and Cascade Rules","text":"<ul> <li><code>api_keys.user_id</code> and <code>minecraft_servers.owner_id</code> reference <code>users.id</code>. The implementations enforce referential integrity at the application layer; deleting a user should be preceded by reassignment or cleanup of dependent records.</li> <li>Server operations first consult the database to verify ownership and permissions, then apply changes to Kubernetes. After a successful cluster operation, the handler updates the corresponding row (status, timestamps) to keep the database authoritative.</li> </ul>"},{"location":"database/#backend-considerations","title":"Backend Considerations","text":"<ul> <li>SQLite is the default backend for development. The database file is created automatically under <code>./app/data/minecharts.db</code> (or <code>DATA_DIR</code>). It supports foreign keys, but ensure <code>PRAGMA foreign_keys = ON</code> if you interact with it manually.</li> <li>PostgreSQL is recommended for production deployments. Provide the connection string through <code>MINECHARTS_DB_CONNECTION</code>. Schema migrations are executed at startup via the database implementation.</li> </ul> <p>Keeping the schema lean makes it straightforward to extend Minecharts with new concepts\u2014add a column, adjust the interface methods, and update both SQLite and PostgreSQL implementations accordingly.</p>"}]}