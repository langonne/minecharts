imagePullSecrets: []

api:
  fullnameOverride: minecharts-api
  appLabel: minecharts-api
  replicaCount: 1
  strategy: Recreate
  image:
    repository: registry.prod.nasdak.fr/l.angonnet/minecharts/api
    tag: latest
    pullPolicy: Always
  serviceAccount:
    create: true
    name: minecharts-api
  rbac:
    create: true
  service:
    # Default to ClusterIP; use NodePort/LoadBalancer only if you need direct access without ingress.
    type: ClusterIP
    port: 8080
    targetPort: 8080
    nodePort: null
  persistence:
    # Keeps JWT secret and optional SQLite DB on disk. Disable only if you use Postgres
    # and can tolerate regenerating the JWT secret on every restart.
    enabled: true
    existingClaim: ""
    claimName: minecharts-api-data-pvc
    storageClass: ""
    accessModes:
      - ReadWriteOnce
    # JWT alone is a few bytes; if your storage class allows it, 1Mi is enough.
    # Default kept higher for compatibility; bump to ~1Gi if you keep SQLite on disk.
    size: 32Mi
    mountPath: /app/data
  resources:
    requests:
      memory: "128Mi"
      cpu: "100m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  env:
    - name: MINECHARTS_MCROUTER_DOMAIN_SUFFIX
      value: "minecharts.example.com"
    # - name: MINECHARTS_DB_TYPE
    #   value: "postgres" # or "sqlite"
    # - name: MINECHARTS_DB_CONNECTION
    #   value: "postgres://user:pass@host:5432/minecharts?sslmode=disable"
    # - name: MINECHARTS_TRUSTED_PROXIES
    #   value: "127.0.0.1,10.0.0.0/8"
    # - name: MINECHARTS_TIMEZONE
    #   value: "UTC"
    # - name: MINECHARTS_LOG_LEVEL
    #   value: "info" # trace|debug|info|warn|error|fatal|panic
    # - name: MINECHARTS_LOG_FORMAT
    #   value: "json" # json|text
    # - name: MINECHARTS_JWT_EXPIRY_HOURS
    #   value: "24"
    # - name: MINECHARTS_API_KEY_PREFIX
    #   value: "mcapi"
    # - name: MINECHARTS_ALLOW_SELF_REGISTRATION
    #   value: "false"
    # - name: MINECHARTS_DEFAULT_USER_PERMISSIONS
    #   value: "operator" # aliases: none|readonly|operator|all or numeric bitmask (admin bit stripped)
    # - name: MINECHARTS_FRONTEND_URL
    #   value: "http://localhost:3000"
    # - name: MINECHARTS_MEMORY_QUOTA_ENABLED
    #   value: "false"
    # - name: MINECHARTS_MEMORY_QUOTA_LIMIT
    #   value: "0" # gigabytes; 0 disables the cap
    # - name: MINECHARTS_MEMORY_LIMIT_OVERHEAD_PERCENT
    #   value: "25" # percent of MEMORY added as overhead to set the container limit
    # # Deprecated alias (will be removed): MINECHARTS_MEMORY_LIMIT_OVERHEAD_MI
    # - name: MINECHARTS_WEB_ADMIN_WARNINGS_ENABLED
    #   value: "true" # expose admin warnings to the web UI via /api/admin/warnings
    # - name: MINECHARTS_API_KEYS_PER_USER
    #   value: "5"
    # - name: MINECHARTS_OAUTH_ENABLED
    #   value: "false"
    # - name: MINECHARTS_OAUTH_PROVIDER_NAME
    #   value: "myprovider"
    # - name: MINECHARTS_OAUTH_PROVIDER_DISPLAY_NAME
    #   value: "My Provider"
    # - name: MINECHARTS_OIDC_ISSUER
    #   value: "https://authentik.example.com/application/o/minecharts/"
    # - name: MINECHARTS_OIDC_CLIENT_ID
    #   value: ""
    # - name: MINECHARTS_OIDC_CLIENT_SECRET
    #   value: ""
    # - name: MINECHARTS_OIDC_REDIRECT_URL
    #   value: "https://minecharts.example.com/api/auth/callback/authentik"
    # - name: MINECHARTS_AUTHENTIK_GROUP_SYNC_ENABLED
    #   value: "false"
    # - name: MINECHARTS_AUTHENTIK_ADMIN_GROUP
    #   value: ""
    # - name: MINECHARTS_AUTHENTIK_USER_GROUP
    #   value: ""
    # - name: MINECHARTS_AUTHENTIK_USER_PERMISSIONS
    #   value: "operator"
    # - name: MINECHARTS_FEEDBACK_ENABLED
    #   value: "false"
    # - name: MINECHARTS_FEEDBACK_PROVIDER
    #   value: "github" # or gitlab
    # - name: MINECHARTS_FEEDBACK_GITHUB_TOKEN
    #   value: ""
    # - name: MINECHARTS_FEEDBACK_GITHUB_REPO_OWNER
    #   value: ""
    # - name: MINECHARTS_FEEDBACK_GITHUB_REPO_NAME
    #   value: ""
    # - name: MINECHARTS_FEEDBACK_GITLAB_TOKEN
    #   value: ""
    # - name: MINECHARTS_FEEDBACK_GITLAB_PROJECT
    #   value: ""
    # - name: MINECHARTS_FEEDBACK_GITLAB_URL
    #   value: "https://gitlab.com"
    # - name: MINECHARTS_FEEDBACK_DEFAULT_LABELS
    #   value: "feedback"
    # - name: MINECHARTS_RATE_LIMIT_LOGIN_CAPACITY
    #   value: "10"
    # - name: MINECHARTS_RATE_LIMIT_LOGIN_INTERVAL
    #   value: "1m"
    # - name: MINECHARTS_RATE_LIMIT_REGISTER_CAPACITY
    #   value: "4"
    # - name: MINECHARTS_RATE_LIMIT_REGISTER_INTERVAL
    #   value: "5m"
    # - name: MINECHARTS_RATE_LIMIT_USER_PATCH_CAPACITY
    #   value: "10"
    # - name: MINECHARTS_RATE_LIMIT_USER_PATCH_INTERVAL
    #   value: "1m"
    # - name: MINECHARTS_RATE_LIMIT_CLEANUP_EVERY
    #   value: "100"
    # - name: MINECHARTS_RATE_LIMIT_RETENTION
    #   value: "30m"
  secretEnv: []
  envFromSecrets: []

web:
  fullnameOverride: minecharts-web
  appLabel: minecharts
  replicaCount: 1
  strategy: Recreate
  image:
    repository: registry.prod.nasdak.fr/l.angonnet/minecharts/web
    tag: latest
    pullPolicy: Always
  serviceAccount:
    create: true
    name: minecharts
  rbac:
    create: true
  service:
    type: ClusterIP
    port: 80
    targetPort: 80
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "512Mi"
      cpu: "500m"
  env:
    # Set to false if it's behind a reverse proxy that provide it certificate, set to true and bring yours
    - name: ENABLE_TLS
      value: "FALSE"
  secretEnv: []
  envFromSecrets: []

middleware:
  enabled: true
  name: minecharts-api-strip
  prefixes:
    - /api

ingress:
  enabled: true
  nameOverride: minecharts
  className: ""
  annotations:
    # Specific to your cluster
    cert-manager.io/cluster-issuer: letsencrypt-production
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    traefik.ingress.kubernetes.io/router.tls: "true"
  middlewareAnnotation: true
  host: minecharts.example.com
  tls:
    enabled: true
    secretName: ""
