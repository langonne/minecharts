{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Minecharts API","text":"<p>Minecharts API automates the lifecycle of Minecraft servers inside a Kubernetes cluster. This site gives you the essentials required to run and operate the service without overwhelming detail.</p>"},{"location":"#what-the-platform-does","title":"What the Platform Does","text":"<ul> <li>Spins up Kubernetes StatefulSets backed by persistent volumes, using the <code>itzg/minecraft-server</code> image as a base.</li> <li>Enforces authentication through JWT cookies or API keys, then applies fine-grained permissions on each request.</li> <li>Tracks users, keys, and server metadata in a database so that cluster state and API state remain aligned.</li> </ul>"},{"location":"#how-to-use-this-documentation","title":"How to Use This Documentation","text":"<ul> <li>Understand how clients interact with the service: API Overview</li> <li>Configure runtime behaviour and storage: Configuration</li> <li>Explore the persistence model and relationships: Database Architecture</li> </ul> <p>Fast feedback loop</p> <p>Keep a terminal with <code>kubectl</code> open when experimenting. Watching StatefulSets, pods, and PVCs appear alongside API responses is the fastest way to build intuition.</p>"},{"location":"additional-tweaks/","title":"Additional Tweaks","text":"<p>Some behaviours live outside the environment variable matrix but remain easy to tailor if your deployment model differs from the defaults.</p> <ul> <li>Default replicas: The API provisions one pod per server by default (<code>DefaultReplicas = 1</code>). Adjust the value in <code>cmd/config/config.go</code> if you want newly created worlds to spawn with more replicas.</li> <li>Container security context: Managed pods run as UID/GID <code>1000</code> and include a pre-stop hook that flushes the world save. Modify <code>cmd/kubernetes/deployement.go</code> to adapt permissions or lifecycle hooks.</li> <li>Graceful shutdown timing: The command guard (<code>mc-send-to-console save-all</code>) and wait duration before pod restart (<code>time.Second * 10</code>) are located in <code>cmd/kubernetes/utils.go</code>. Update them to match your workload\u2019s expectations.</li> </ul> <p>Expose new knobs</p> <p>Whenever you add a setting, route it through <code>cmd/config/config.go</code> so it\u2019s configurable via environment variables instead of code changes.</p>"},{"location":"configuration/","title":"Configuration","text":"<p>Minecharts API reads its configuration from environment variables at startup (<code>cmd/config/config.go</code>). The following tables enumerate every supported variable and the resulting behaviour.</p>"},{"location":"configuration/#core-settings","title":"Core Settings","text":"Variable Default Purpose <code>MINECHARTS_NAMESPACE</code> <code>minecharts</code> Kubernetes namespace that hosts StatefulSets, services, and PVCs. <code>MINECHARTS_STATEFULSET_PREFIX</code> <code>minecraft-server-</code> Prefix applied to server names to build StatefulSet/service names. <code>MINECHARTS_PVC_SUFFIX</code> <code>-pvc</code> Suffix appended to PVC names. <code>MINECHARTS_STORAGE_SIZE</code> <code>10Gi</code> Capacity requested for each persistent volume claim. <code>MINECHARTS_STORAGE_CLASS</code> (empty) Storage class used when creating PVCs; leave empty to let Kubernetes pick the cluster default automatically.Example: <code>local-path</code> <code>MINECHARTS_MCROUTER_DOMAIN_SUFFIX</code> (empty) Domain suffix used when exposing servers through mc-router; required for the API to start.Example: <code>mc.example.com</code> <code>MINECHARTS_TRUSTED_PROXIES</code> <code>127.0.0.1</code> Comma-separated list passed to Gin to mark upstream proxies as trusted. <code>MINECHARTS_TIMEZONE</code> <code>UTC</code> Application-wide timezone for logging and time calculations. <code>MINECHARTS_WEB_ADMIN_WARNINGS_ENABLED</code> <code>true</code> Enables the admin warnings endpoint consumed by the web UI (<code>/api/admin/warnings</code>). <code>MINECHARTS_MEMORY_QUOTA_ENABLED</code> <code>false</code> Enables enforcement of the global Minecraft memory quota. <code>MINECHARTS_MEMORY_QUOTA_LIMIT</code> <code>0</code> Maximum total memory (gigabytes) the cluster may allocate to Minecraft servers when the quota is enabled. <code>0</code> or negative values are treated as unlimited. <code>MINECHARTS_MEMORY_LIMIT_OVERHEAD_PERCENT</code> <code>25</code> Percentage of each server\u2019s <code>MEMORY</code> added as overhead when enforcing Kubernetes limits (e.g. <code>MEMORY=4G</code> and <code>25</code> \u2192 limit set to <code>5Gi</code>). <code>DATA_DIR</code> <code>./app/data</code> Local directory for SQLite data when the DB is auto-initialised. <p>Memory quota accounting</p> <p>When <code>MINECHARTS_MEMORY_QUOTA_ENABLED</code> is <code>true</code>, quota checks use the same value as the Kubernetes limit: <code>MEMORY + overhead%</code>. The remaining budget is therefore the cluster-side cost (including overhead), not just the raw <code>MEMORY</code> value.</p> <p>Memory overhead (limit buffer)</p> <p>The <code>MEMORY</code> value is forwarded as-is to the <code>itzg/minecraft-server</code> container and set as the pod\u2019s memory request. The limit is <code>MEMORY + (MEMORY * MINECHARTS_MEMORY_LIMIT_OVERHEAD_PERCENT / 100)</code>. With the default <code>25</code>, a <code>MEMORY</code> of <code>4G</code> translates to a request of <code>4Gi</code> and a limit of roughly <code>5Gi</code>. If the container exceeds the limit, Kubernetes will OOM-kill the pod. Negative overhead values are clamped to zero.</p> <p>Deprecated alias</p> <p><code>MINECHARTS_MEMORY_LIMIT_OVERHEAD_MI</code> remains accepted for backward compatibility but is deprecated and will be removed in a future release. A startup warning is logged when it is used. Migrate to <code>MINECHARTS_MEMORY_LIMIT_OVERHEAD_PERCENT</code>.</p>"},{"location":"configuration/#minecraft-server-environment-variables","title":"Minecraft server environment variables","text":"<p>Every key/value under the <code>env</code> object of <code>POST /servers</code> is forwarded to the underlying <code>itzg/minecraft-server</code> container. <code>MEMORY</code> sets the pod\u2019s memory request and, with the configured overhead percentage, the limit (see above). Quota checks also use this limit. Refer to the image documentation for supported options: https://docker-minecraft-server.readthedocs.io/en/latest/variables/.</p> <p>Legacy vanilla safeguard</p> <p>For vanilla servers targeting versions older than <code>1.12</code>, Minecharts automatically injects <code>USE_NATIVE_TRANSPORT=false</code> (unless you set it yourself) to prevent native transport issues on these builds.</p> <p>MOTD limits</p> <p>The MOTD may contain at most one newline (two lines total) and up to 59 visible characters. Formatting/color codes (<code>&amp;x</code>/<code>\u00a7x</code>) don\u2019t count toward the limit and are forwarded to the server as <code>\u00a7</code> codes.</p>"},{"location":"configuration/#database","title":"Database","text":"Variable Default Purpose <code>MINECHARTS_DB_TYPE</code> <code>sqlite</code> Database backend (<code>sqlite</code> or <code>postgres</code>). <code>MINECHARTS_DB_CONNECTION</code> <code>./app/data/minecharts.db</code> File path for SQLite or connection string for PostgreSQL."},{"location":"configuration/#authentication-security","title":"Authentication &amp; Security","text":"Variable Default Purpose <code>MINECHARTS_JWT_EXPIRY_HOURS</code> <code>24</code> Token lifespan in hours. <code>MINECHARTS_API_KEY_PREFIX</code> <code>mcapi</code> Prefix applied to generated API keys. <code>MINECHARTS_ALLOW_SELF_REGISTRATION</code> <code>false</code> When <code>false</code>, <code>/auth/register</code> is restricted to authenticated admins; when <code>true</code>, anyone can create an account (rate-limited). <code>MINECHARTS_DEFAULT_USER_PERMISSIONS</code> <code>operator</code> Default permissions for newly created users (self-registration and OAuth); accepts aliases (<code>none</code>, <code>readonly</code>, <code>operator</code>, <code>all</code>) or a numeric bitmask. The admin bit is always stripped. <code>MINECHARTS_FRONTEND_URL</code> <code>http://localhost:3000</code> Frontend base URL used for OAuth callbacks/redirects after login. <p>Handy defaults</p> <p><code>operator</code> grants every permission except admin (<code>PermOperator</code>), making it a safe default for non-privileged accounts. Aliases also accept numeric bitmasks if you want direct control.</p>"},{"location":"configuration/#permission-flags-and-common-masks","title":"Permission flags and common masks","text":"Name Value Grants <code>PermAdmin</code> <code>1</code> Full administrator access. <code>PermCreateServer</code> <code>2</code> Create new servers. <code>PermDeleteServer</code> <code>4</code> Delete servers. <code>PermStartServer</code> <code>8</code> Start servers. <code>PermStopServer</code> <code>16</code> Stop servers. <code>PermRestartServer</code> <code>32</code> Restart servers. <code>PermExecCommand</code> <code>64</code> Execute commands on servers. <code>PermViewServer</code> <code>128</code> View server details. <p>Common combinations: - <code>PermReadOnly</code> = <code>128</code> - <code>PermOperator</code> = <code>254</code> (all above except admin) - <code>PermAll</code> = <code>255</code> (admin + all other flags)</p> <p>Admin bit is stripped</p> <p><code>MINECHARTS_DEFAULT_USER_PERMISSIONS</code> and <code>MINECHARTS_AUTHENTIK_USER_PERMISSIONS</code> always drop the admin bit, even if you provide <code>all</code> or <code>255</code>, to avoid accidental escalation. Reserve admin for the dedicated group (<code>MINECHARTS_AUTHENTIK_ADMIN_GROUP</code>) or manual assignment.</p>"},{"location":"configuration/#oauth-oidc-single-provider","title":"OAuth &amp; OIDC (single provider)","text":"<p>OAuth integration is optional. Enable it by setting <code>MINECHARTS_OAUTH_ENABLED</code> to <code>true</code>. A single OIDC provider is configured via environment variables.</p>"},{"location":"configuration/#oidc-provider-settings","title":"OIDC provider settings","text":"Variable Default Purpose <code>MINECHARTS_OAUTH_ENABLED</code> <code>false</code> Enables the OAuth endpoints under <code>/auth/oauth/:provider</code>. <code>MINECHARTS_OAUTH_PROVIDER_NAME</code> (empty) Required. Slug used in routes <code>/auth/oauth/{name}</code> and the callback path; no spaces. Exposed to the frontend. <code>MINECHARTS_OAUTH_PROVIDER_DISPLAY_NAME</code> (empty) Human-friendly name exposed to the frontend; defaults to <code>MINECHARTS_OAUTH_PROVIDER_NAME</code> when empty. <code>MINECHARTS_OIDC_ISSUER</code> (empty) OIDC issuer URL used for discovery via <code>/.well-known/openid-configuration</code>. <code>MINECHARTS_OIDC_CLIENT_ID</code> (empty) Client ID registered with the OIDC provider. <code>MINECHARTS_OIDC_CLIENT_SECRET</code> (empty) Client secret registered with the OIDC provider. <code>MINECHARTS_OIDC_REDIRECT_URL</code> (empty) Redirect URL registered with the OIDC provider. <p>Note</p> <p>The issuer must expose a valid OIDC discovery document at <code>/.well-known/openid-configuration</code>. Pure OAuth2 providers without OIDC discovery (e.g. GitHub/Discord OAuth) are not supported by this generic flow; you need an OIDC-compliant provider. There is no dedicated Authentik enable toggle; use the OIDC variables above.</p>"},{"location":"configuration/#authentik-compat-and-group-sync","title":"Authentik (compat and group sync)","text":"Variable Default Purpose <code>MINECHARTS_AUTHENTIK_GROUP_SYNC_ENABLED</code> <code>false</code> When <code>true</code>, Minecharts inspects the <code>groups</code> claim to map users to Minecharts roles automatically; admin rights are granted and revoked to mirror the configured group membership. <code>MINECHARTS_AUTHENTIK_ADMIN_GROUP</code> (empty) Name of the group that should receive Minecharts admin permissions (case-insensitive). Required when group sync is enabled. <code>MINECHARTS_AUTHENTIK_USER_GROUP</code> (empty) Optional non-admin Authentik group to sync. When present, members receive <code>MINECHARTS_AUTHENTIK_USER_PERMISSIONS</code>; others fall back to <code>MINECHARTS_DEFAULT_USER_PERMISSIONS</code>. <code>MINECHARTS_AUTHENTIK_USER_PERMISSIONS</code> (empty) Permissions to grant to members of <code>MINECHARTS_AUTHENTIK_USER_GROUP</code>. Accepts the same aliases/bitmask as <code>MINECHARTS_DEFAULT_USER_PERMISSIONS</code>. Defaults to the configured default user permissions. The admin bit is always stripped. <p>Authentik sync scenario</p> <ul> <li><code>MINECHARTS_AUTHENTIK_GROUP_SYNC_ENABLED=true</code></li> <li><code>MINECHARTS_AUTHENTIK_ADMIN_GROUP=minecharts-admins</code></li> <li><code>MINECHARTS_AUTHENTIK_USER_GROUP=minecharts-operators</code></li> <li><code>MINECHARTS_AUTHENTIK_USER_PERMISSIONS=operator</code></li> </ul> <p>Outcome: <code>minecharts-admins</code> members get admin; <code>minecharts-operators</code> members get all permissions except admin; everyone else falls back to <code>MINECHARTS_DEFAULT_USER_PERMISSIONS</code> (default <code>operator</code>).</p>"},{"location":"configuration/#logging","title":"Logging","text":"Variable Default Purpose <code>MINECHARTS_LOG_LEVEL</code> <code>info</code> Supported levels: <code>trace</code>, <code>debug</code>, <code>info</code>, <code>warn</code>, <code>error</code>, <code>fatal</code>, <code>panic</code>. <code>MINECHARTS_LOG_FORMAT</code> <code>json</code> Output format for Logrus (<code>json</code> or <code>text</code>). <code>MINECHARTS_BCRYPT_COST</code> <code>14</code> Work factor for bcrypt hashing (valid range 4\u201331); raise for stronger security at the cost of CPU."},{"location":"configuration/#rate-limiting","title":"Rate Limiting","text":"Variable Default Purpose <code>MINECHARTS_RATE_LIMIT_LOGIN_CAPACITY</code> <code>10</code> Maximum bursts allowed for <code>POST /auth/login</code> per IP. <code>MINECHARTS_RATE_LIMIT_LOGIN_INTERVAL</code> <code>1m</code> Refill interval (Go duration format) for login tokens. <code>MINECHARTS_RATE_LIMIT_REGISTER_CAPACITY</code> <code>4</code> Maximum bursts allowed for <code>POST /auth/register</code> per IP. <code>MINECHARTS_RATE_LIMIT_REGISTER_INTERVAL</code> <code>5m</code> Refill interval for registration tokens. <code>MINECHARTS_RATE_LIMIT_USER_PATCH_CAPACITY</code> <code>10</code> Maximum bursts allowed for <code>PATCH /users/:id</code> per IP. <code>MINECHARTS_RATE_LIMIT_USER_PATCH_INTERVAL</code> <code>1m</code> Refill interval for user patch tokens. <code>MINECHARTS_RATE_LIMIT_CLEANUP_EVERY</code> <code>100</code> Cleanup frequency (in requests) for purging stale rate-limit rows. <code>MINECHARTS_RATE_LIMIT_RETENTION</code> <code>30m</code> How long to retain inactive rate-limit rows before cleanup. <code>MINECHARTS_API_KEYS_PER_USER</code> <code>5</code> Maximum number of active API keys per user. <p>Note</p> <p>The limiter state lives in the application database. PostgreSQL handles concurrent updates efficiently; SQLite serialises writes and may emit short <code>database is locked</code> retries under load. For high-traffic deployments, prefer PostgreSQL or an external rate-limiting tier.</p>"},{"location":"configuration/#feedback-issue-reporting","title":"Feedback &amp; Issue Reporting","text":"Variable Default Purpose <code>MINECHARTS_FEEDBACK_ENABLED</code> <code>false</code> Enables the authenticated <code>POST /feedback</code> endpoint that raises issues on behalf of users. <code>MINECHARTS_FEEDBACK_PROVIDER</code> (unset) Required when feedback is enabled; set to <code>github</code> or <code>gitlab</code>. <code>MINECHARTS_FEEDBACK_GITHUB_TOKEN</code> (empty) GitHub personal access token used when the provider is <code>github</code>. <code>MINECHARTS_FEEDBACK_GITHUB_REPO_OWNER</code> (empty) GitHub repository owner (user or organisation) that will receive feedback issues. <code>MINECHARTS_FEEDBACK_GITHUB_REPO_NAME</code> (empty) GitHub repository name where issues are created. <code>MINECHARTS_FEEDBACK_GITLAB_TOKEN</code> (empty) GitLab personal access token used when the provider is <code>gitlab</code>. <code>MINECHARTS_FEEDBACK_GITLAB_PROJECT</code> (empty) GitLab project path or numeric ID that receives feedback issues.Examples: <code>group/subgroup/minecharts</code> or <code>37</code>. <code>MINECHARTS_FEEDBACK_GITLAB_URL</code> <code>https://gitlab.com</code> Base URL for the GitLab instance (e.g. <code>https://gitlab.example.com</code>). <code>MINECHARTS_FEEDBACK_DEFAULT_LABELS</code> <code>feedback</code> Comma-separated labels automatically added to each generated issue (in addition to type-specific labels). <p>The API automatically manages the JWT signing key in <code>&lt;DATA_DIR&gt;/jwt.secret</code>. Delete the file to rotate the key, and keep <code>DATA_DIR</code> on persistent storage so tokens remain valid across restarts.</p> <p>If feedback is enabled but the required credentials for the selected provider are missing, the API logs an error and any submission returns a <code>500</code> response.</p> <p>Extend the configuration package with additional environment variables when introducing new behaviours so that operators can tune the system without recompiling.</p>"},{"location":"database/","title":"Database Architecture","text":"<p>Minecharts API keeps a compact schema that mirrors the main concepts exposed by the service: users, their credentials, issued API keys, and Minecraft servers with their Kubernetes bindings. The database layer implements the same interface for SQLite (default) and PostgreSQL, so the schema applies to both backends.</p>"},{"location":"database/#core-tables","title":"Core Tables","text":""},{"location":"database/#users","title":"<code>users</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>username</code> TEXT Unique per user; used for login. <code>email</code> TEXT Optional contact address; must be unique. <code>password_hash</code> TEXT bcrypt hash created by the API. <code>permissions</code> BIGINT Bitmask containing permission flags (admin, create server, etc.). <code>active</code> BOOLEAN Controls whether the account can authenticate. <code>last_login</code> TIMESTAMP NULL Updated after successful login. <code>created_at</code> / <code>updated_at</code> TIMESTAMP Auditing metadata. <p>The permission mask is defined in <code>cmd/database/models.go</code> and shared across backends. Administrators can update it directly through the API.</p>"},{"location":"database/#api_keys","title":"<code>api_keys</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>user_id</code> BIGINT Foreign key to <code>users.id</code>. <code>key</code> TEXT Generated token (hash or plain string depending on backend). Stored in full; listings only display a masked prefix. <code>description</code> TEXT Optional label to distinguish automated clients. <code>last_used</code> TIMESTAMP NULL Updated when the key authenticates a request. <code>expires_at</code> TIMESTAMP NULL Optional expiration timestamp. <code>created_at</code> TIMESTAMP Creation time. <p>Deleting a key removes the row and immediately invalidates future requests using the token.</p>"},{"location":"database/#minecraft_servers","title":"<code>minecraft_servers</code>","text":"Column Type Notes <code>id</code> BIGINT Primary key. <code>server_name</code> TEXT Logical name provided by the user. <code>statefulset_name</code> TEXT Prefixed name used for the Kubernetes StatefulSet. <code>pvc_name</code> TEXT Persistent volume claim name derived from the StatefulSet. <code>owner_id</code> BIGINT Foreign key to <code>users.id</code>; identifies who can manage the server. <code>max_memory_gb</code> INTEGER Memory cap (gigabytes) propagated to the <code>MEMORY</code> container variable. Defaults to <code>1</code> when omitted. <code>status</code> TEXT Cached status (<code>running</code>, <code>stopped</code>, etc.). <code>created_at</code> / <code>updated_at</code> TIMESTAMP Lifecycle metadata. <p>The API derives <code>statefulset_name</code> and <code>pvc_name</code> using configuration values (<code>MINECHARTS_STATEFULSET_PREFIX</code> and <code>MINECHARTS_PVC_SUFFIX</code>) to keep database records and Kubernetes resources aligned.</p> <p>When <code>MINECHARTS_MEMORY_QUOTA_ENABLED</code> is <code>true</code>, the API sums <code>max_memory_gb</code> across all rows before creating a new server and rejects the request if it would exceed <code>MINECHARTS_MEMORY_QUOTA_LIMIT</code>.</p>"},{"location":"database/#relationships-and-cascade-rules","title":"Relationships and Cascade Rules","text":"<ul> <li><code>api_keys.user_id</code> and <code>minecraft_servers.owner_id</code> reference <code>users.id</code>. The implementations enforce referential integrity at the application layer; deleting a user should be preceded by reassignment or cleanup of dependent records.</li> <li>Server operations first consult the database to verify ownership and permissions, then apply changes to Kubernetes. After a successful cluster operation, the handler updates the corresponding row (status, timestamps) to keep the database authoritative.</li> </ul>"},{"location":"database/#backend-considerations","title":"Backend Considerations","text":"<ul> <li>SQLite is the default backend for development. The database file is created automatically under <code>./app/data/minecharts.db</code> (or <code>DATA_DIR</code>). It supports foreign keys, but ensure <code>PRAGMA foreign_keys = ON</code> if you interact with it manually.</li> <li>PostgreSQL is recommended for production deployments. Provide the connection string through <code>MINECHARTS_DB_CONNECTION</code>. Schema migrations are executed at startup via the database implementation.</li> </ul> <p>Keeping the schema lean makes it straightforward to extend Minecharts with new concepts\u2014add a column, adjust the interface methods, and update both SQLite and PostgreSQL implementations accordingly.</p>"},{"location":"helm-chart/","title":"Helm chart (minecharts)","text":"<p>This chart deploys the API and web UI with ingress routing.</p>"},{"location":"helm-chart/#exposure","title":"Exposure","text":"<ul> <li>API Service defaults to <code>ClusterIP</code> and is reached via the ingress rule <code>/api</code>. Traefik middleware (<code>stripPrefix /api</code>) rewrites URLs so the API\u2014served without a prefix\u2014keeps working. Change only if you expose the API differently.</li> <li>Web Service is <code>ClusterIP</code> and served at <code>/</code>.</li> <li>Ingress annotations (<code>cert-manager.io/cluster-issuer</code>, Traefik entrypoints/TLS, etc.) are examples; adapt them to your cluster (issuer name, ingress class, entrypoints).</li> </ul> <p>URL rewriting</p> <p>The <code>stripPrefix /api</code> middleware is enabled by default so the backend can stay prefix-less. If you expose the API anywhere other than <code>/api</code>, adjust or disable it (<code>middleware.enabled=false</code>) to avoid 404s.</p>"},{"location":"helm-chart/#persistence","title":"Persistence","text":"<ul> <li>API: PVC enabled by default to persist the JWT signing key and optionally SQLite. Disable with <code>api.persistence.enabled=false</code> if you run Postgres and accept a regenerated JWT on restart. Size guidance: ~1Mi for JWT only; ~1Gi if you keep SQLite on disk (default <code>size: 32Mi</code> for compatibility).</li> <li>Web: stateless; no PVC requested.</li> </ul> <p>Postgres in production</p> <p>If you run Postgres, disable API persistence (<code>api.persistence.enabled=false</code>) to skip the PVC and supply the JWT key via a Kubernetes Secret.</p>"},{"location":"helm-chart/#secrets","title":"Secrets","text":"<p>Inject secrets without putting them in <code>values.yaml</code></p> <ul> <li> <p><code>secretEnv</code>: map specific keys from an existing Secret to environment variables   <pre><code>api:\n  secretEnv:\n    - name: MINECHARTS_DB_CONNECTION\n      secretName: minecharts-api-secrets\n      secretKey: db-connection\n    - name: MINECHARTS_JWT_SECRET\n      secretName: minecharts-api-secrets\n      secretKey: jwt-secret\n</code></pre>   Each entry becomes an environment variable in the container.</p> </li> <li> <p><code>envFromSecrets</code>: load all keys of a Secret as environment variables (watch for collisions)   <pre><code>api:\n  envFromSecrets:\n    - minecharts-shared-env\n</code></pre></p> </li> <li> <p>The chart does not create Secrets for you: create them separately (kubectl/Argo/etc.) to avoid embedding secrets in <code>values.yaml</code> or the chart.</p> </li> </ul>"},{"location":"helm-chart/#middleware","title":"Middleware","text":"<ul> <li><code>middleware.enabled</code> creates a Traefik <code>stripPrefix</code> middleware (default prefix <code>/api</code>) and annotates the ingress when <code>ingress.middlewareAnnotation</code> is true. Disable only if you serve the API with an <code>/api</code> prefix or use another ingress rewrite mechanism.</li> <li><code>ingress.middlewareAnnotation</code>: when true, the ingress is annotated to use the middleware. Set false if you don\u2019t want the ingress to reference it (e.g., you handle rewrites elsewhere).</li> </ul>"},{"location":"local-development-overlay/","title":"Local Development Overlay","text":"<p>The <code>kubernetes/overlays/test</code> overlay ships with a patch template that keeps developer-specific values outside of Git while still letting you exercise the stack end-to-end.</p> <ol> <li>Copy the sample file:    <pre><code>cp kubernetes/overlays/test/dev-env.example.yaml kubernetes/overlays/test/dev-env.yaml\n</code></pre></li> <li>Update <code>dev-env.yaml</code> with your own values (e.g. <code>MINECHARTS_MCROUTER_DOMAIN_SUFFIX</code>, logging verbosity).</li> <li>Apply the overlay:    <pre><code>kubectl apply -k kubernetes/overlays/test\n</code></pre></li> </ol> <p>Keep local secrets out of Git</p> <p><code>dev-env.yaml</code> is ignored by Git so your local values (domains, tokens, etc.) never get committed. Only the example file stays tracked to show the expected structure.</p>"},{"location":"api/","title":"API Overview","text":"<p>Minecharts API is organised around a small set of REST endpoints that manage authentication, API keys, and Minecraft servers. All requests must use HTTPS in production and include either the session cookie issued at login or an API key in the <code>X-API-Key</code> header.</p> <p>Consult the related guides for deeper details on the authentication model, request lifecycle, operational considerations, and per-endpoint reference material.</p>"},{"location":"api/authentification_model/","title":"Authentication Model","text":"<ul> <li>JWT cookie (<code>auth_token</code>): returned by <code>POST /auth/login</code> and <code>POST /auth/register</code>. The cookie is HttpOnly; enable the <code>Secure</code> flag behind TLS. Include it automatically when calling other endpoints from a browser or HTTP client.</li> <li>API key: obtain one through <code>POST /apikeys</code> after logging in. Supply it via <code>X-API-Key</code>. Keys inherit the permissions of their owner and are ideal for automation where cookies are inconvenient.</li> <li>Permissions: each user carries a bitmask (admin, create server, restart, etc.). The handler chain performs the permission check after authentication; server owners automatically gain control over their own instances even when they do not hold the global bit.</li> </ul> <p>Always enable TLS</p> <p>Serve the API over HTTPS in production. The <code>auth_token</code> cookie is set with <code>Secure</code> + <code>HttpOnly</code>, so it is never sent over plain HTTP\u2014but browsers will still send API key headers, and mixed setups invite downgrade or interception risks. Keep everything on HTTPS end-to-end.</p>"},{"location":"api/operational_notes/","title":"Operational Notes","text":"<ul> <li>The service automatically triggers <code>mc-send-to-console save-all</code> before restart and stop operations. Recent tests with Ceph-backed persistent volumes showed that writes can take a few minutes to settle, occasionally omitting the most recent ticks. The extra save mitigates the inconsistency but plan for a short grace period after each lifecycle change when running on Ceph.</li> <li>API key responses only reveal the raw token during creation. Store it immediately; subsequent listings return masked values.</li> <li>The <code>/servers/{serverName}/expose</code> endpoint deletes any existing service for the StatefulSet before creating a new one, preventing stale exposure modes from lingering.</li> <li>Server creation forwards the <code>env</code> map directly to the <code>itzg/minecraft-server</code> container. Use the upstream variable reference (https://docker-minecraft-server.readthedocs.io/en/latest/variables/) when choosing flags and options.</li> </ul> <p>Slow network volumes (Ceph, etc.)</p> <p>After a <code>save-all</code>, allow a short buffer on slow network storage: writes can land late despite the forced save. Avoid chaining restart/stop/start too quickly in these environments.</p> <p>One-shot API keys</p> <p>The full token is shown only at creation time. Copy it immediately or automate capture in CI/secrets\u2014subsequent calls only return a masked prefix.</p>"},{"location":"api/request_flow/","title":"Request Flow","text":"<ol> <li>Authenticate with a cookie or API key.</li> <li>Authorise: middleware checks the caller's permission mask (plus server ownership when applicable).</li> <li>Persist changes in the database to keep track of owners, StatefulSets, and volumes.</li> <li>Apply changes to the Kubernetes cluster using Client-Go.</li> <li>Log outcomes with per-domain loggers for auditing and troubleshooting.</li> </ol>"},{"location":"api/endpoint/api_keys/","title":"API Key Endpoints","text":""},{"location":"api/endpoint/api_keys/#post-apikeys","title":"<code>POST /apikeys</code>","text":"<ul> <li>Purpose: Generate a new API key (revealed once).</li> <li>Auth required: JWT cookie</li> </ul> <p>Storage</p> <p>API keys are hashed before being stored in the database. Only the identifier and metadata are kept, so the raw value is visible only in the creation response. Rotate or reissue keys if you suspect a leak.</p> RequestResponse <pre><code>POST /apikeys HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\nContent-Type: application/json\n\n{\n  \"description\": \"CI pipeline\",\n  \"expires_at\": \"2025-01-01T00:00:00Z\"\n}\n</code></pre> <pre><code>{\n  \"id\": 42,\n  \"key\": \"mcapi.1df3c0d9f95f4a6f\",\n  \"description\": \"CI pipeline\",\n  \"expires_at\": \"2025-01-01T00:00:00Z\",\n  \"created_at\": \"2024-05-06T18:42:11Z\"\n}\n</code></pre>"},{"location":"api/endpoint/api_keys/#get-apikeys","title":"<code>GET /apikeys</code>","text":"<ul> <li>Purpose: List keys owned by the caller.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>GET /apikeys HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>[\n  {\n    \"id\": 42,\n    \"key\": \"mcapi.1df3c0...\",\n    \"description\": \"CI pipeline\",\n    \"last_used\": \"2024-05-12T09:17:22Z\",\n    \"expires_at\": \"2025-01-01T00:00:00Z\",\n    \"created_at\": \"2024-05-06T18:42:11Z\"\n  }\n]\n</code></pre>"},{"location":"api/endpoint/api_keys/#delete-apikeysid","title":"<code>DELETE /apikeys/{id}</code>","text":"<ul> <li>Purpose: Revoke a key immediately.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>DELETE /apikeys/42 HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"API key deleted successfully\"\n}\n</code></pre>"},{"location":"api/endpoint/authentification/","title":"Authentication Endpoints","text":""},{"location":"api/endpoint/authentification/#post-authregister","title":"<code>POST /auth/register</code>","text":"<ul> <li>Purpose: Create a user account and issue an authenticated session.</li> <li>Auth required: None when <code>MINECHARTS_ALLOW_SELF_REGISTRATION=true</code>; otherwise admin JWT (default).</li> </ul> <p>Self-registration toggle</p> <p>By default (<code>MINECHARTS_ALLOW_SELF_REGISTRATION=false</code>), this endpoint is locked behind admin authentication and is intended to be used from the admin panel. Set <code>MINECHARTS_ALLOW_SELF_REGISTRATION=true</code> to open public signups (still subject to rate limiting). OAuth/OIDC flows remain unchanged by this toggle.</p> RequestResponse <pre><code>POST /auth/register HTTP/1.1\nContent-Type: application/json\n\n{\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"password\": \"Sup3rStrongPassword!\"\n}\n</code></pre> <pre><code>{\n  \"token\": \"&lt;jwt&gt;\",\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 0\n}\n</code></pre>"},{"location":"api/endpoint/authentification/#post-authlogin","title":"<code>POST /auth/login</code>","text":"<ul> <li>Purpose: Authenticate an existing user and receive the <code>auth_token</code> cookie.</li> <li>Auth required: None</li> </ul> <p>Rate limiting</p> <p>This endpoint (and user registration) is protected by a shared token-bucket rated at ten login attempts per minute (four registrations every five minutes) per client IP. Successful requests refill progressively. When the bucket is empty, the API responds with HTTP 429 (<code>Retry-After</code> header in seconds). The limiter state is stored in the configured database so limits are consistent across application instances. On SQLite, heavy login traffic may lead to short lock retries; for high-volume production deployments prefer PostgreSQL or an external rate-limit tier.</p> RequestResponse <pre><code>POST /auth/login HTTP/1.1\nContent-Type: application/json\n\n{\n  \"username\": \"overseer\",\n  \"password\": \"Sup3rStrongPassword!\"\n}\n</code></pre> <pre><code>{\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 255\n}\n</code></pre>"},{"location":"api/endpoint/authentification/#post-authlogout","title":"<code>POST /auth/logout</code>","text":"<ul> <li>Purpose: Invalidate the active session cookie.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>POST /auth/logout HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Logout successful\",\n  \"status\": \"success\"\n}\n</code></pre>"},{"location":"api/endpoint/authentification/#get-authme","title":"<code>GET /auth/me</code>","text":"<ul> <li>Purpose: Retrieve the authenticated user profile and permissions.</li> <li>Auth required: JWT cookie</li> </ul> RequestResponse <pre><code>GET /auth/me HTTP/1.1\nCookie: auth_token=&lt;jwt&gt;\n</code></pre> <pre><code>{\n  \"user_id\": 1,\n  \"username\": \"overseer\",\n  \"email\": \"overseer@example.com\",\n  \"permissions\": 255,\n  \"active\": true,\n  \"last_login\": \"2024-05-10T18:12:44Z\",\n  \"created_at\": \"2024-03-01T09:15:32Z\"\n}\n</code></pre>"},{"location":"api/endpoint/feedback/","title":"Feedback Endpoint","text":""},{"location":"api/endpoint/feedback/#post-feedback","title":"<code>POST /feedback</code>","text":"<ul> <li>Purpose: Allow signed-in users to report bugs or request features.</li> <li>Auth required: JWT cookie (<code>MINECHARTS_FEEDBACK_ENABLED</code> must be <code>true</code>).</li> </ul> <p>The backend validates submissions and forwards them to either GitHub or GitLab, depending on <code>MINECHARTS_FEEDBACK_PROVIDER</code>.</p> RequestResponse <pre><code>POST /feedback HTTP/1.1\nContent-Type: application/json\n\n{\n  \"type\": \"bug\",\n  \"title\": \"Nether portal crashes the server\",\n  \"description\": \"Whenever we light the portal the server stops responding after ~30s.\",\n  \"email\": \"player@example.com\"\n}\n</code></pre> <pre><code>{\n  \"issue_url\": \"https://gitlab.example.com/my-group/minecharts/-/issues/101\",\n  \"issue_number\": 101\n}\n</code></pre>"},{"location":"api/endpoint/feedback/#validation-rules","title":"Validation rules","text":"<ul> <li><code>type</code> accepts <code>bug</code>, <code>feature</code>, or anything else (treated as <code>other</code>).</li> <li><code>title</code> and <code>description</code> are mandatory; titles are capped at 140 characters, descriptions at 5000.</li> <li>Optional <code>email</code> is trimmed and length-checked (320 characters max).</li> <li>Caller must be authenticated; the issue body includes the user ID and username.</li> </ul>"},{"location":"api/endpoint/feedback/#failure-responses","title":"Failure responses","text":"<ul> <li><code>404 Not Found</code> when the feedback endpoint is disabled.</li> <li><code>401 Unauthorized</code> if the caller is not logged in.</li> <li><code>400 Bad Request</code> for invalid payloads or missing required fields.</li> <li><code>500 Internal Server Error</code> when feedback is enabled but misconfigured (missing token, bad provider, etc.).</li> <li><code>502 Bad Gateway</code> if the target forge rejects the issue creation (temporary error).</li> </ul>"},{"location":"api/endpoint/quota/","title":"Quota Endpoints","text":""},{"location":"api/endpoint/quota/#get-quotamemory","title":"<code>GET /quota/memory</code>","text":"<ul> <li>Purpose: Report memory quota usage (requests + overhead) for Minecraft servers.</li> <li>Auth required: JWT or API key + <code>PermCreateServer</code></li> </ul> Response <pre><code>{\n  \"unlimited\": false,\n  \"limitGi\": 64,\n  \"usedGi\": 18.75,\n  \"remainingGi\": 45.25,\n  \"overheadPercent\": 25\n}\n</code></pre>"},{"location":"api/endpoint/quota/#fields","title":"Fields","text":"<ul> <li><code>unlimited</code> - <code>true</code> when the quota is disabled (<code>MINECHARTS_MEMORY_QUOTA_ENABLED=false</code> or limit \u2264 0).</li> <li><code>limitGi</code> - Quota limit in GiB (includes overhead).</li> <li><code>usedGi</code> / <code>remainingGi</code> - Current usage and available budget in GiB, computed as <code>MEMORY + overhead%</code> for every server.</li> <li><code>overheadPercent</code> - Current overhead percentage used to compute limits/quota (<code>MINECHARTS_MEMORY_LIMIT_OVERHEAD_PERCENT</code>, clamped at zero).</li> </ul> <p>Client-side validation</p> <p>To estimate the cost of a new server locally: <code>costGi = MEMORY + (MEMORY * overheadPercent / 100)</code>. Compare <code>costGi</code> to <code>remainingGi</code> to pre-flight the request before calling <code>POST /servers</code>.</p>"},{"location":"api/endpoint/servers/","title":"Server Endpoints","text":""},{"location":"api/endpoint/servers/#post-servers","title":"<code>POST /servers</code>","text":"<ul> <li>Purpose: Provision a server (PVC + StatefulSet + Service) for the caller.</li> <li>Auth required: JWT cookie or API key + <code>PermCreateServer</code></li> </ul> RequestResponse <pre><code>POST /servers HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"serverName\": \"survival\",\n  \"env\": {\n    \"EULA\": \"TRUE\",\n    \"TYPE\": \"PAPER\",\n    \"VERSION\": \"1.21.1\",\n    \"MEMORY\": \"4G\",\n    \"DIFFICULTY\": \"hard\"\n  }\n}\n</code></pre> <pre><code>{\n  \"message\": \"Minecraft server started\",\n  \"statefulSetName\": \"minecraft-server-survival\",\n  \"pvcName\": \"minecraft-server-survival-pvc\",\n  \"domain\": \"survival.test.nasdak.fr\",\n  \"serviceName\": \"minecraft-server-survival\",\n  \"url\": \"survival.test.nasdak.fr\"\n}\n</code></pre> <p>Workload naming</p> <p>The <code>statefulSetName</code> fields returned by the API mirror the Kubernetes StatefulSet names backing each server. The Service name is the same as the StatefulSet (no <code>-svc</code> suffix) to satisfy mc-router auto-discovery/auto-scale expectations.</p> <p>MOTD length</p> <p>The MOTD may contain at most one newline (two lines total) and must not exceed 59 visible characters (formatting/color codes ignored).</p> <p>Environment value constraints</p> <p>Environment variable names must use letters, numbers, or underscores (up to 64 characters). Values are capped at 2048 characters and may not contain control characters (newlines are allowed only for <code>MOTD</code>). <code>CF_API_KEY</code> must use only letters, numbers, <code>$</code>, <code>.</code>, and <code>/</code>; <code>CF_PAGE_URL</code> must start with <code>https://www.curseforge.com/</code>.</p> <p>MCRouter URL</p> <p>The <code>url</code> field is returned only when the backing Kubernetes service carries the <code>mc-router.itzg.me/externalServerName</code> annotation (i.e. the server is routed through mc-router).</p>"},{"location":"api/endpoint/servers/#get-servers","title":"<code>GET /servers</code>","text":"<ul> <li>Purpose: List servers owned by the caller.</li> <li>Auth required: JWT cookie or API key + <code>PermViewServer</code></li> </ul> RequestResponse <pre><code>GET /servers HTTP/1.1\nX-API-Key: mcapi.abcd1234\n</code></pre> <pre><code>[\n  {\n    \"id\": 12,\n    \"server_name\": \"survival\",\n    \"statefulset_name\": \"minecraft-server-survival\",\n    \"pvc_name\": \"minecraft-server-survival-pvc\",\n    \"owner_id\": 1,\n    \"status\": \"running\",\n    \"created_at\": \"2024-05-01T10:00:00Z\",\n    \"updated_at\": \"2024-05-12T08:30:00Z\",\n    \"url\": \"survival.test.nasdak.fr\",\n    \"environment\": {\n      \"EULA\": \"TRUE\",\n      \"MEMORY\": \"4G\",\n      \"MODE\": \"survival\"\n    }\n  }\n]\n</code></pre> <p>Conditional URL</p> <p><code>url</code> is emitted only for servers exposed via mc-router.</p>"},{"location":"api/endpoint/servers/#get-serversservername","title":"<code>GET /servers/{serverName}</code>","text":"<ul> <li>Purpose: Retrieve logical metadata, environment variables, and status for a server.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermViewServer</code></li> </ul> <p>Server name format</p> <p>Server identifiers must comply with Kubernetes DNS-1123 naming: lowercase letters, digits, and dashes only, up to 63 characters. Requests with invalid names are rejected with HTTP 400.</p> RequestResponse <pre><code>GET /servers/survival HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"id\": 12,\n  \"server_name\": \"survival\",\n  \"statefulset_name\": \"minecraft-server-survival\",\n  \"pvc_name\": \"minecraft-server-survival-pvc\",\n  \"owner_id\": 1,\n  \"status\": \"running\",\n  \"created_at\": \"2024-05-01T10:00:00Z\",\n  \"updated_at\": \"2024-05-12T08:30:00Z\",\n  \"url\": \"survival.test.nasdak.fr\",\n  \"environment\": {\n    \"EULA\": \"TRUE\",\n    \"TYPE\": \"PAPER\",\n    \"VERSION\": \"1.21.1\",\n    \"MEMORY\": \"4G\"\n  }\n}\n</code></pre> <p>Conditional URL</p> <p>The per-server <code>url</code> appears only when the Kubernetes service uses the mc-router annotation. The <code>statefulset_name</code> field corresponds to the StatefulSet backing the server.</p>"},{"location":"api/endpoint/servers/#post-serversservernamerestart","title":"<code>POST /servers/{serverName}/restart</code>","text":"<ul> <li>Purpose: Save the world, update the StatefulSet template, and trigger a rollout.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermRestartServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/restart HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server restart triggered\",\n  \"statefulSetName\": \"minecraft-server-survival\",\n  \"stdout\": \"[Server thread/INFO]: Saved the game\",\n  \"stderr\": \"\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernamestop","title":"<code>POST /servers/{serverName}/stop</code>","text":"<ul> <li>Purpose: Scale the StatefulSet to zero replicas.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermStopServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/stop HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server stopping (replicas scaled to 0)\",\n  \"statefulSetName\": \"minecraft-server-survival\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernamestart","title":"<code>POST /servers/{serverName}/start</code>","text":"<ul> <li>Purpose: Scale the StatefulSet back to one replica.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermStartServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/start HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"Server starting (StatefulSet scaled to 1)\",\n  \"statefulSetName\": \"minecraft-server-survival\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernamedelete","title":"<code>POST /servers/{serverName}/delete</code>","text":"<ul> <li>Purpose: Delete the StatefulSet, service, PVC, and database record.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermDeleteServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/delete HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\n</code></pre> <pre><code>{\n  \"message\": \"StatefulSet, PVC and network resources deleted\",\n  \"statefulSetName\": \"minecraft-server-survival\",\n  \"pvcName\": \"minecraft-server-survival-pvc\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernameexec","title":"<code>POST /servers/{serverName}/exec</code>","text":"<ul> <li>Purpose: Run a console command via <code>mc-send-to-console</code> inside the pod.</li> <li>Auth required: JWT cookie or API key + owner or <code>PermExecCommand</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/exec HTTP/1.1\nX-API-Key: mcapi.abcd1234\nContent-Type: application/json\n\n{\n  \"command\": \"say Hello from automation!\"\n}\n</code></pre> <pre><code>{\n  \"stdout\": \"[Server thread/INFO]: [Server] Hello from automation!\\n\",\n  \"stderr\": \"\",\n  \"command\": \"say Hello from automation!\"\n}\n</code></pre>"},{"location":"api/endpoint/servers/#post-serversservernameexpose","title":"<code>POST /servers/{serverName}/expose</code>","text":"<ul> <li>Purpose: Recreate the service (ClusterIP, NodePort, LoadBalancer, or mc-router mode).</li> <li>Auth required: JWT cookie or API key + owner or <code>PermCreateServer</code></li> </ul> RequestResponse <pre><code>POST /servers/survival/expose HTTP/1.1\nAuthorization: Bearer &lt;token&gt;\nContent-Type: application/json\n\n{\n  \"exposureType\": \"NodePort\",\n  \"port\": 25565\n}\n</code></pre> <pre><code>{\n  \"message\": \"Service created\",\n  \"serviceName\": \"minecraft-server-survival\",\n  \"exposureType\": \"NodePort\",\n  \"serviceType\": \"NodePort\",\n  \"nodePort\": 32751\n}\n</code></pre>"},{"location":"api/endpoint/servers/#get-ws-websocket-log-stream","title":"<code>GET /ws</code> (WebSocket log stream)","text":"<ul> <li>Purpose: Stream <code>logs/latest.log</code> from a running Minecraft pod in real time.</li> <li> <p>Auth required: JWT cookie (<code>auth_token</code>) or API key (<code>X-API-Key</code> header on the upgrade request) + owner or <code>PermViewServer</code> permission for the target server.</p> </li> <li> <p>Open a WebSocket connection to <code>GET /ws</code>, including the authentication headers/cookies you normally use with the API.</p> </li> <li> <p>Immediately after the handshake, send a single JSON message selecting the server:</p> <pre><code>{ \"server_id\": 42 }\n</code></pre> <p>The <code>server_id</code> is the numeric identifier returned by <code>GET /servers</code>.</p> </li> <li> <p>When the subscription is accepted, the API responds with a <code>status</code> message and begins streaming the log file.</p> </li> </ul>"},{"location":"api/endpoint/servers/#message-types","title":"Message types","text":"<ul> <li><code>{\"type\":\"status\",\"message\":\"connected\"}</code> \u2014 WebSocket upgrade acknowledged.</li> <li><code>{\"type\":\"status\",\"message\":\"streaming\"}</code> \u2014 log streaming has started.</li> <li><code>{\"type\":\"log\",\"data\":\"[Server thread/INFO]: ...\\n\"}</code> \u2014 raw lines from <code>logs/latest.log</code> (standard output).</li> <li><code>{\"type\":\"error\",\"message\":\"...\"}</code> \u2014 authentication/authorization errors, missing pods, or stderr output from the tail command.</li> </ul> <p>The server executes <code>tail -n +1 -F</code>, so the entire file is replayed before following new lines. Each client connection has its own tail process; closing the WebSocket stops the stream immediately.</p>"},{"location":"api/endpoint/users/","title":"User Administration Endpoints","text":""},{"location":"api/endpoint/users/#get-users","title":"<code>GET /users</code>","text":"<ul> <li>Purpose: List every user in the system.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>GET /users HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>[\n  {\n    \"id\": 1,\n    \"username\": \"admin\",\n    \"email\": \"admin@example.com\",\n    \"permissions\": 255,\n    \"active\": true,\n    \"last_login\": \"2024-05-10T18:12:44Z\",\n    \"created_at\": \"2024-03-01T09:15:32Z\",\n    \"updated_at\": \"2024-05-10T18:12:44Z\"\n  }\n]\n</code></pre>"},{"location":"api/endpoint/users/#get-usersid","title":"<code>GET /users/{id}</code>","text":"<ul> <li>Purpose: Retrieve a specific user. Non-admins can fetch their own record only.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code> (or matching user ID)</li> </ul> RequestResponse <pre><code>GET /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>{\n  \"id\": 2,\n  \"username\": \"builder\",\n  \"email\": \"builder@example.com\",\n  \"permissions\": 10,\n  \"active\": true,\n  \"last_login\": \"2024-05-08T14:02:11Z\",\n  \"created_at\": \"2024-04-20T12:00:00Z\",\n  \"updated_at\": \"2024-05-08T14:02:11Z\"\n}\n</code></pre>"},{"location":"api/endpoint/users/#patch-usersid","title":"<code>PATCH /users/{id}</code>","text":"<ul> <li>Purpose: Partially update username, email, password, permissions, or active flag.</li> <li>Auth required: JWT cookie. Users may patch their own record; administrators may patch any user. Only admins may modify <code>permissions</code> or <code>active</code>.</li> </ul> <p>Rate limiting</p> <p>Updates are throttled to five attempts per minute per client IP to contain brute-force password checks and account enumeration. As with the authentication endpoints, the limiter state is persisted in the database. Under heavy concurrency SQLite can emit brief <code>database is locked</code> retries; PostgreSQL is recommended for large installations.</p> Self-updateAdmin updateResponse <pre><code>PATCH /users/2 HTTP/1.1\nCookie: auth_token=&lt;user_jwt&gt;\nContent-Type: application/json\n\n{\n  \"email\": \"player2@example.com\",\n  \"password\": {\n    \"current\": \"OldPassword123!\",\n    \"new\": \"NewPassword456@\",\n    \"confirm\": \"NewPassword456@\"\n  }\n}\n</code></pre> <pre><code>PATCH /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"username\": \"builder\",\n  \"permissions\": 10,\n  \"active\": true\n}\n</code></pre> <pre><code>{\n  \"id\": 2,\n  \"username\": \"builder\",\n  \"email\": \"player2@example.com\",\n  \"permissions\": 10,\n  \"active\": true,\n  \"last_login\": \"2024-05-08T14:02:11Z\",\n  \"updated_at\": \"2024-05-12T10:05:33Z\"\n}\n</code></pre> <p>Password policy</p> <p>When changing a password, the payload must include <code>current</code>, <code>new</code>, and <code>confirm</code>. The new password must be at least 12 characters long and contain upper-case, lower-case, digit, and symbol characters.</p>"},{"location":"api/endpoint/users/#post-usersidpermissionsgrant","title":"<code>POST /users/{id}/permissions/grant</code>","text":"<ul> <li>Purpose: Add one or more permission bits to a user.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>POST /users/2/permissions/grant HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"permissions\": [\n    { \"permission\": 2, \"name\": \"PermDeleteServer\" },\n    { \"permission\": 64, \"name\": \"PermExecCommand\" }\n  ]\n}\n</code></pre> <pre><code>{\n  \"user_id\": 2,\n  \"username\": \"builder\",\n  \"old_permissions\": 8,\n  \"new_permissions\": 74\n}\n</code></pre>"},{"location":"api/endpoint/users/#post-usersidpermissionsrevoke","title":"<code>POST /users/{id}/permissions/revoke</code>","text":"<ul> <li>Purpose: Remove permission bits from a user.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>POST /users/2/permissions/revoke HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\nContent-Type: application/json\n\n{\n  \"permissions\": [\n    { \"permission\": 2 },\n    { \"permission\": 64 }\n  ]\n}\n</code></pre> <pre><code>{\n  \"user_id\": 2,\n  \"username\": \"builder\",\n  \"old_permissions\": 74,\n  \"new_permissions\": 8\n}\n</code></pre>"},{"location":"api/endpoint/users/#delete-usersid","title":"<code>DELETE /users/{id}</code>","text":"<ul> <li>Purpose: Permanently delete a user account.</li> <li>Auth required: JWT cookie + <code>PermAdmin</code></li> </ul> RequestResponse <pre><code>DELETE /users/2 HTTP/1.1\nCookie: auth_token=&lt;admin_jwt&gt;\n</code></pre> <pre><code>{\n  \"message\": \"User deleted\"\n}\n</code></pre>"}]}